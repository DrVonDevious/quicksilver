{"ast":null,"code":"var ElementType = require(\"domelementtype\");\n\nvar re_whitespace = /\\s+/g;\n\nvar NodePrototype = require(\"./lib/node\");\n\nvar ElementPrototype = require(\"./lib/element\");\n\nfunction DomHandler(callback, options, elementCB) {\n  if (typeof callback === \"object\") {\n    elementCB = options;\n    options = callback;\n    callback = null;\n  } else if (typeof options === \"function\") {\n    elementCB = options;\n    options = defaultOpts;\n  }\n\n  this._callback = callback;\n  this._options = options || defaultOpts;\n  this._elementCB = elementCB;\n  this.dom = [];\n  this._done = false;\n  this._tagStack = [];\n  this._parser = this._parser || null;\n} //default options\n\n\nvar defaultOpts = {\n  normalizeWhitespace: false,\n  //Replace all whitespace with single spaces\n  withStartIndices: false //Add startIndex properties to nodes\n\n};\n\nDomHandler.prototype.onparserinit = function (parser) {\n  this._parser = parser;\n}; //Resets the handler back to starting state\n\n\nDomHandler.prototype.onreset = function () {\n  DomHandler.call(this, this._callback, this._options, this._elementCB);\n}; //Signals the handler that parsing is done\n\n\nDomHandler.prototype.onend = function () {\n  if (this._done) return;\n  this._done = true;\n  this._parser = null;\n\n  this._handleCallback(null);\n};\n\nDomHandler.prototype._handleCallback = DomHandler.prototype.onerror = function (error) {\n  if (typeof this._callback === \"function\") {\n    this._callback(error, this.dom);\n  } else {\n    if (error) throw error;\n  }\n};\n\nDomHandler.prototype.onclosetag = function () {\n  //if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\n  var elem = this._tagStack.pop();\n\n  if (this._elementCB) this._elementCB(elem);\n};\n\nDomHandler.prototype._addDomElement = function (element) {\n  var parent = this._tagStack[this._tagStack.length - 1];\n  var siblings = parent ? parent.children : this.dom;\n  var previousSibling = siblings[siblings.length - 1];\n  element.next = null;\n\n  if (this._options.withStartIndices) {\n    element.startIndex = this._parser.startIndex;\n  }\n\n  if (this._options.withDomLvl1) {\n    element.__proto__ = element.type === \"tag\" ? ElementPrototype : NodePrototype;\n  }\n\n  if (previousSibling) {\n    element.prev = previousSibling;\n    previousSibling.next = element;\n  } else {\n    element.prev = null;\n  }\n\n  siblings.push(element);\n  element.parent = parent || null;\n};\n\nDomHandler.prototype.onopentag = function (name, attribs) {\n  var element = {\n    type: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\n    name: name,\n    attribs: attribs,\n    children: []\n  };\n\n  this._addDomElement(element);\n\n  this._tagStack.push(element);\n};\n\nDomHandler.prototype.ontext = function (data) {\n  //the ignoreWhitespace is officially dropped, but for now,\n  //it's an alias for normalizeWhitespace\n  var normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\n  var lastTag;\n\n  if (!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length - 1]).type === ElementType.Text) {\n    if (normalize) {\n      lastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n    } else {\n      lastTag.data += data;\n    }\n  } else {\n    if (this._tagStack.length && (lastTag = this._tagStack[this._tagStack.length - 1]) && (lastTag = lastTag.children[lastTag.children.length - 1]) && lastTag.type === ElementType.Text) {\n      if (normalize) {\n        lastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n      } else {\n        lastTag.data += data;\n      }\n    } else {\n      if (normalize) {\n        data = data.replace(re_whitespace, \" \");\n      }\n\n      this._addDomElement({\n        data: data,\n        type: ElementType.Text\n      });\n    }\n  }\n};\n\nDomHandler.prototype.oncomment = function (data) {\n  var lastTag = this._tagStack[this._tagStack.length - 1];\n\n  if (lastTag && lastTag.type === ElementType.Comment) {\n    lastTag.data += data;\n    return;\n  }\n\n  var element = {\n    data: data,\n    type: ElementType.Comment\n  };\n\n  this._addDomElement(element);\n\n  this._tagStack.push(element);\n};\n\nDomHandler.prototype.oncdatastart = function () {\n  var element = {\n    children: [{\n      data: \"\",\n      type: ElementType.Text\n    }],\n    type: ElementType.CDATA\n  };\n\n  this._addDomElement(element);\n\n  this._tagStack.push(element);\n};\n\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function () {\n  this._tagStack.pop();\n};\n\nDomHandler.prototype.onprocessinginstruction = function (name, data) {\n  this._addDomElement({\n    name: name,\n    data: data,\n    type: ElementType.Directive\n  });\n};\n\nmodule.exports = DomHandler;","map":{"version":3,"sources":["/Users/william/Dev/quicksilver/node_modules/cheerio/node_modules/domhandler/index.js"],"names":["ElementType","require","re_whitespace","NodePrototype","ElementPrototype","DomHandler","callback","options","elementCB","defaultOpts","_callback","_options","_elementCB","dom","_done","_tagStack","_parser","normalizeWhitespace","withStartIndices","prototype","onparserinit","parser","onreset","call","onend","_handleCallback","onerror","error","onclosetag","elem","pop","_addDomElement","element","parent","length","siblings","children","previousSibling","next","startIndex","withDomLvl1","__proto__","type","prev","push","onopentag","name","attribs","Script","Style","Tag","ontext","data","normalize","ignoreWhitespace","lastTag","Text","replace","oncomment","Comment","oncdatastart","CDATA","oncommentend","oncdataend","onprocessinginstruction","Directive","module","exports"],"mappings":"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","sourcesContent":["var ElementType = require(\"domelementtype\");\n\nvar re_whitespace = /\\s+/g;\nvar NodePrototype = require(\"./lib/node\");\nvar ElementPrototype = require(\"./lib/element\");\n\nfunction DomHandler(callback, options, elementCB){\n\tif(typeof callback === \"object\"){\n\t\telementCB = options;\n\t\toptions = callback;\n\t\tcallback = null;\n\t} else if(typeof options === \"function\"){\n\t\telementCB = options;\n\t\toptions = defaultOpts;\n\t}\n\tthis._callback = callback;\n\tthis._options = options || defaultOpts;\n\tthis._elementCB = elementCB;\n\tthis.dom = [];\n\tthis._done = false;\n\tthis._tagStack = [];\n\tthis._parser = this._parser || null;\n}\n\n//default options\nvar defaultOpts = {\n\tnormalizeWhitespace: false, //Replace all whitespace with single spaces\n\twithStartIndices: false, //Add startIndex properties to nodes\n};\n\nDomHandler.prototype.onparserinit = function(parser){\n\tthis._parser = parser;\n};\n\n//Resets the handler back to starting state\nDomHandler.prototype.onreset = function(){\n\tDomHandler.call(this, this._callback, this._options, this._elementCB);\n};\n\n//Signals the handler that parsing is done\nDomHandler.prototype.onend = function(){\n\tif(this._done) return;\n\tthis._done = true;\n\tthis._parser = null;\n\tthis._handleCallback(null);\n};\n\nDomHandler.prototype._handleCallback =\nDomHandler.prototype.onerror = function(error){\n\tif(typeof this._callback === \"function\"){\n\t\tthis._callback(error, this.dom);\n\t} else {\n\t\tif(error) throw error;\n\t}\n};\n\nDomHandler.prototype.onclosetag = function(){\n\t//if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\n\tvar elem = this._tagStack.pop();\n\tif(this._elementCB) this._elementCB(elem);\n};\n\nDomHandler.prototype._addDomElement = function(element){\n\tvar parent = this._tagStack[this._tagStack.length - 1];\n\tvar siblings = parent ? parent.children : this.dom;\n\tvar previousSibling = siblings[siblings.length - 1];\n\n\telement.next = null;\n\n\tif(this._options.withStartIndices){\n\t\telement.startIndex = this._parser.startIndex;\n\t}\n\n\tif (this._options.withDomLvl1) {\n\t\telement.__proto__ = element.type === \"tag\" ? ElementPrototype : NodePrototype;\n\t}\n\n\tif(previousSibling){\n\t\telement.prev = previousSibling;\n\t\tpreviousSibling.next = element;\n\t} else {\n\t\telement.prev = null;\n\t}\n\n\tsiblings.push(element);\n\telement.parent = parent || null;\n};\n\nDomHandler.prototype.onopentag = function(name, attribs){\n\tvar element = {\n\t\ttype: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\n\t\tname: name,\n\t\tattribs: attribs,\n\t\tchildren: []\n\t};\n\n\tthis._addDomElement(element);\n\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.ontext = function(data){\n\t//the ignoreWhitespace is officially dropped, but for now,\n\t//it's an alias for normalizeWhitespace\n\tvar normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\n\n\tvar lastTag;\n\n\tif(!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length-1]).type === ElementType.Text){\n\t\tif(normalize){\n\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n\t\t} else {\n\t\t\tlastTag.data += data;\n\t\t}\n\t} else {\n\t\tif(\n\t\t\tthis._tagStack.length &&\n\t\t\t(lastTag = this._tagStack[this._tagStack.length - 1]) &&\n\t\t\t(lastTag = lastTag.children[lastTag.children.length - 1]) &&\n\t\t\tlastTag.type === ElementType.Text\n\t\t){\n\t\t\tif(normalize){\n\t\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n\t\t\t} else {\n\t\t\t\tlastTag.data += data;\n\t\t\t}\n\t\t} else {\n\t\t\tif(normalize){\n\t\t\t\tdata = data.replace(re_whitespace, \" \");\n\t\t\t}\n\n\t\t\tthis._addDomElement({\n\t\t\t\tdata: data,\n\t\t\t\ttype: ElementType.Text\n\t\t\t});\n\t\t}\n\t}\n};\n\nDomHandler.prototype.oncomment = function(data){\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\n\n\tif(lastTag && lastTag.type === ElementType.Comment){\n\t\tlastTag.data += data;\n\t\treturn;\n\t}\n\n\tvar element = {\n\t\tdata: data,\n\t\ttype: ElementType.Comment\n\t};\n\n\tthis._addDomElement(element);\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.oncdatastart = function(){\n\tvar element = {\n\t\tchildren: [{\n\t\t\tdata: \"\",\n\t\t\ttype: ElementType.Text\n\t\t}],\n\t\ttype: ElementType.CDATA\n\t};\n\n\tthis._addDomElement(element);\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function(){\n\tthis._tagStack.pop();\n};\n\nDomHandler.prototype.onprocessinginstruction = function(name, data){\n\tthis._addDomElement({\n\t\tname: name,\n\t\tdata: data,\n\t\ttype: ElementType.Directive\n\t});\n};\n\nmodule.exports = DomHandler;\n"]},"metadata":{},"sourceType":"script"}