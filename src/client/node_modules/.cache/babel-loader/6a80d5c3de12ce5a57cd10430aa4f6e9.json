{"ast":null,"code":"var index = require(\"./index.js\"),\n    DomHandler = index.DomHandler,\n    DomUtils = index.DomUtils; //TODO: make this a streamable handler\n\n\nfunction FeedHandler(callback, options) {\n  this.init(callback, options);\n}\n\nrequire(\"util\").inherits(FeedHandler, DomHandler);\n\nFeedHandler.prototype.init = DomHandler;\n\nfunction getElements(what, where) {\n  return DomUtils.getElementsByTagName(what, where, true);\n}\n\nfunction getOneElement(what, where) {\n  return DomUtils.getElementsByTagName(what, where, true, 1)[0];\n}\n\nfunction fetch(what, where, recurse) {\n  return DomUtils.getText(DomUtils.getElementsByTagName(what, where, recurse, 1)).trim();\n}\n\nfunction addConditionally(obj, prop, what, where, recurse) {\n  var tmp = fetch(what, where, recurse);\n  if (tmp) obj[prop] = tmp;\n}\n\nvar isValidFeed = function isValidFeed(value) {\n  return value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n};\n\nFeedHandler.prototype.onend = function () {\n  var feed = {},\n      feedRoot = getOneElement(isValidFeed, this.dom),\n      tmp,\n      childs;\n\n  if (feedRoot) {\n    if (feedRoot.name === \"feed\") {\n      childs = feedRoot.children;\n      feed.type = \"atom\";\n      addConditionally(feed, \"id\", \"id\", childs);\n      addConditionally(feed, \"title\", \"title\", childs);\n      if ((tmp = getOneElement(\"link\", childs)) && (tmp = tmp.attribs) && (tmp = tmp.href)) feed.link = tmp;\n      addConditionally(feed, \"description\", \"subtitle\", childs);\n      if (tmp = fetch(\"updated\", childs)) feed.updated = new Date(tmp);\n      addConditionally(feed, \"author\", \"email\", childs, true);\n      feed.items = getElements(\"entry\", childs).map(function (item) {\n        var entry = {},\n            tmp;\n        item = item.children;\n        addConditionally(entry, \"id\", \"id\", item);\n        addConditionally(entry, \"title\", \"title\", item);\n        if ((tmp = getOneElement(\"link\", item)) && (tmp = tmp.attribs) && (tmp = tmp.href)) entry.link = tmp;\n        if (tmp = fetch(\"summary\", item) || fetch(\"content\", item)) entry.description = tmp;\n        if (tmp = fetch(\"updated\", item)) entry.pubDate = new Date(tmp);\n        return entry;\n      });\n    } else {\n      childs = getOneElement(\"channel\", feedRoot.children).children;\n      feed.type = feedRoot.name.substr(0, 3);\n      feed.id = \"\";\n      addConditionally(feed, \"title\", \"title\", childs);\n      addConditionally(feed, \"link\", \"link\", childs);\n      addConditionally(feed, \"description\", \"description\", childs);\n      if (tmp = fetch(\"lastBuildDate\", childs)) feed.updated = new Date(tmp);\n      addConditionally(feed, \"author\", \"managingEditor\", childs, true);\n      feed.items = getElements(\"item\", feedRoot.children).map(function (item) {\n        var entry = {},\n            tmp;\n        item = item.children;\n        addConditionally(entry, \"id\", \"guid\", item);\n        addConditionally(entry, \"title\", \"title\", item);\n        addConditionally(entry, \"link\", \"link\", item);\n        addConditionally(entry, \"description\", \"description\", item);\n        if (tmp = fetch(\"pubDate\", item)) entry.pubDate = new Date(tmp);\n        return entry;\n      });\n    }\n  }\n\n  this.dom = feed;\n\n  DomHandler.prototype._handleCallback.call(this, feedRoot ? null : Error(\"couldn't find root of feed\"));\n};\n\nmodule.exports = FeedHandler;","map":{"version":3,"sources":["/Users/william/Dev/quicksilver/client/node_modules/cheerio/node_modules/htmlparser2/lib/FeedHandler.js"],"names":["index","require","DomHandler","DomUtils","FeedHandler","callback","options","init","inherits","prototype","getElements","what","where","getElementsByTagName","getOneElement","fetch","recurse","getText","trim","addConditionally","obj","prop","tmp","isValidFeed","value","onend","feed","feedRoot","dom","childs","name","children","type","attribs","href","link","updated","Date","items","map","item","entry","description","pubDate","substr","id","_handleCallback","call","Error","module","exports"],"mappings":"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","sourcesContent":["var index = require(\"./index.js\"),\n    DomHandler = index.DomHandler,\n\tDomUtils = index.DomUtils;\n\n//TODO: make this a streamable handler\nfunction FeedHandler(callback, options){\n\tthis.init(callback, options);\n}\n\nrequire(\"util\").inherits(FeedHandler, DomHandler);\n\nFeedHandler.prototype.init = DomHandler;\n\nfunction getElements(what, where){\n\treturn DomUtils.getElementsByTagName(what, where, true);\n}\nfunction getOneElement(what, where){\n\treturn DomUtils.getElementsByTagName(what, where, true, 1)[0];\n}\nfunction fetch(what, where, recurse){\n\treturn DomUtils.getText(\n\t\tDomUtils.getElementsByTagName(what, where, recurse, 1)\n\t).trim();\n}\n\nfunction addConditionally(obj, prop, what, where, recurse){\n\tvar tmp = fetch(what, where, recurse);\n\tif(tmp) obj[prop] = tmp;\n}\n\nvar isValidFeed = function(value){\n\treturn value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n};\n\nFeedHandler.prototype.onend = function(){\n\tvar feed = {},\n\t\tfeedRoot = getOneElement(isValidFeed, this.dom),\n\t\ttmp, childs;\n\n\tif(feedRoot){\n\t\tif(feedRoot.name === \"feed\"){\n\t\t\tchilds = feedRoot.children;\n\n\t\t\tfeed.type = \"atom\";\n\t\t\taddConditionally(feed, \"id\", \"id\", childs);\n\t\t\taddConditionally(feed, \"title\", \"title\", childs);\n\t\t\tif((tmp = getOneElement(\"link\", childs)) && (tmp = tmp.attribs) && (tmp = tmp.href)) feed.link = tmp;\n\t\t\taddConditionally(feed, \"description\", \"subtitle\", childs);\n\t\t\tif((tmp = fetch(\"updated\", childs))) feed.updated = new Date(tmp);\n\t\t\taddConditionally(feed, \"author\", \"email\", childs, true);\n\n\t\t\tfeed.items = getElements(\"entry\", childs).map(function(item){\n\t\t\t\tvar entry = {}, tmp;\n\n\t\t\t\titem = item.children;\n\n\t\t\t\taddConditionally(entry, \"id\", \"id\", item);\n\t\t\t\taddConditionally(entry, \"title\", \"title\", item);\n\t\t\t\tif((tmp = getOneElement(\"link\", item)) && (tmp = tmp.attribs) && (tmp = tmp.href)) entry.link = tmp;\n\t\t\t\tif((tmp = fetch(\"summary\", item) || fetch(\"content\", item))) entry.description = tmp;\n\t\t\t\tif((tmp = fetch(\"updated\", item))) entry.pubDate = new Date(tmp);\n\t\t\t\treturn entry;\n\t\t\t});\n\t\t} else {\n\t\t\tchilds = getOneElement(\"channel\", feedRoot.children).children;\n\n\t\t\tfeed.type = feedRoot.name.substr(0, 3);\n\t\t\tfeed.id = \"\";\n\t\t\taddConditionally(feed, \"title\", \"title\", childs);\n\t\t\taddConditionally(feed, \"link\", \"link\", childs);\n\t\t\taddConditionally(feed, \"description\", \"description\", childs);\n\t\t\tif((tmp = fetch(\"lastBuildDate\", childs))) feed.updated = new Date(tmp);\n\t\t\taddConditionally(feed, \"author\", \"managingEditor\", childs, true);\n\n\t\t\tfeed.items = getElements(\"item\", feedRoot.children).map(function(item){\n\t\t\t\tvar entry = {}, tmp;\n\n\t\t\t\titem = item.children;\n\n\t\t\t\taddConditionally(entry, \"id\", \"guid\", item);\n\t\t\t\taddConditionally(entry, \"title\", \"title\", item);\n\t\t\t\taddConditionally(entry, \"link\", \"link\", item);\n\t\t\t\taddConditionally(entry, \"description\", \"description\", item);\n\t\t\t\tif((tmp = fetch(\"pubDate\", item))) entry.pubDate = new Date(tmp);\n\t\t\t\treturn entry;\n\t\t\t});\n\t\t}\n\t}\n\tthis.dom = feed;\n\tDomHandler.prototype._handleCallback.call(\n\t\tthis, feedRoot ? null : Error(\"couldn't find root of feed\")\n\t);\n};\n\nmodule.exports = FeedHandler;\n"]},"metadata":{},"sourceType":"script"}