{"ast":null,"code":"var Tokenizer = require(\"./Tokenizer.js\");\n/*\n\tOptions:\n\n\txmlMode: Disables the special behavior for script/style tags (false by default)\n\tlowerCaseAttributeNames: call .toLowerCase for each attribute name (true if xmlMode is `false`)\n\tlowerCaseTags: call .toLowerCase for each tag name (true if xmlMode is `false`)\n*/\n\n/*\n\tCallbacks:\n\n\toncdataend,\n\toncdatastart,\n\tonclosetag,\n\toncomment,\n\toncommentend,\n\tonerror,\n\tonopentag,\n\tonprocessinginstruction,\n\tonreset,\n\tontext\n*/\n\n\nvar formTags = {\n  input: true,\n  option: true,\n  optgroup: true,\n  select: true,\n  button: true,\n  datalist: true,\n  textarea: true\n};\nvar openImpliesClose = {\n  tr: {\n    tr: true,\n    th: true,\n    td: true\n  },\n  th: {\n    th: true\n  },\n  td: {\n    thead: true,\n    th: true,\n    td: true\n  },\n  body: {\n    head: true,\n    link: true,\n    script: true\n  },\n  li: {\n    li: true\n  },\n  p: {\n    p: true\n  },\n  h1: {\n    p: true\n  },\n  h2: {\n    p: true\n  },\n  h3: {\n    p: true\n  },\n  h4: {\n    p: true\n  },\n  h5: {\n    p: true\n  },\n  h6: {\n    p: true\n  },\n  select: formTags,\n  input: formTags,\n  output: formTags,\n  button: formTags,\n  datalist: formTags,\n  textarea: formTags,\n  option: {\n    option: true\n  },\n  optgroup: {\n    optgroup: true\n  }\n};\nvar voidElements = {\n  __proto__: null,\n  area: true,\n  base: true,\n  basefont: true,\n  br: true,\n  col: true,\n  command: true,\n  embed: true,\n  frame: true,\n  hr: true,\n  img: true,\n  input: true,\n  isindex: true,\n  keygen: true,\n  link: true,\n  meta: true,\n  param: true,\n  source: true,\n  track: true,\n  wbr: true,\n  //common self closing svg elements\n  path: true,\n  circle: true,\n  ellipse: true,\n  line: true,\n  rect: true,\n  use: true,\n  stop: true,\n  polyline: true,\n  polygon: true\n};\nvar re_nameEnd = /\\s|\\//;\n\nfunction Parser(cbs, options) {\n  this._options = options || {};\n  this._cbs = cbs || {};\n  this._tagname = \"\";\n  this._attribname = \"\";\n  this._attribvalue = \"\";\n  this._attribs = null;\n  this._stack = [];\n  this.startIndex = 0;\n  this.endIndex = null;\n  this._lowerCaseTagNames = \"lowerCaseTags\" in this._options ? !!this._options.lowerCaseTags : !this._options.xmlMode;\n  this._lowerCaseAttributeNames = \"lowerCaseAttributeNames\" in this._options ? !!this._options.lowerCaseAttributeNames : !this._options.xmlMode;\n  this._tokenizer = new Tokenizer(this._options, this);\n  if (this._cbs.onparserinit) this._cbs.onparserinit(this);\n}\n\nrequire(\"util\").inherits(Parser, require(\"events\").EventEmitter);\n\nParser.prototype._updatePosition = function (initialOffset) {\n  if (this.endIndex === null) {\n    if (this._tokenizer._sectionStart <= initialOffset) {\n      this.startIndex = 0;\n    } else {\n      this.startIndex = this._tokenizer._sectionStart - initialOffset;\n    }\n  } else this.startIndex = this.endIndex + 1;\n\n  this.endIndex = this._tokenizer.getAbsoluteIndex();\n}; //Tokenizer event handlers\n\n\nParser.prototype.ontext = function (data) {\n  this._updatePosition(1);\n\n  this.endIndex--;\n  if (this._cbs.ontext) this._cbs.ontext(data);\n};\n\nParser.prototype.onopentagname = function (name) {\n  if (this._lowerCaseTagNames) {\n    name = name.toLowerCase();\n  }\n\n  this._tagname = name;\n\n  if (!this._options.xmlMode && name in openImpliesClose) {\n    for (var el; ((el = this._stack[this._stack.length - 1]) in openImpliesClose[name]); this.onclosetag(el));\n  }\n\n  if (this._options.xmlMode || !(name in voidElements)) {\n    this._stack.push(name);\n  }\n\n  if (this._cbs.onopentagname) this._cbs.onopentagname(name);\n  if (this._cbs.onopentag) this._attribs = {};\n};\n\nParser.prototype.onopentagend = function () {\n  this._updatePosition(1);\n\n  if (this._attribs) {\n    if (this._cbs.onopentag) this._cbs.onopentag(this._tagname, this._attribs);\n    this._attribs = null;\n  }\n\n  if (!this._options.xmlMode && this._cbs.onclosetag && this._tagname in voidElements) {\n    this._cbs.onclosetag(this._tagname);\n  }\n\n  this._tagname = \"\";\n};\n\nParser.prototype.onclosetag = function (name) {\n  this._updatePosition(1);\n\n  if (this._lowerCaseTagNames) {\n    name = name.toLowerCase();\n  }\n\n  if (this._stack.length && (!(name in voidElements) || this._options.xmlMode)) {\n    var pos = this._stack.lastIndexOf(name);\n\n    if (pos !== -1) {\n      if (this._cbs.onclosetag) {\n        pos = this._stack.length - pos;\n\n        while (pos--) this._cbs.onclosetag(this._stack.pop());\n      } else this._stack.length = pos;\n    } else if (name === \"p\" && !this._options.xmlMode) {\n      this.onopentagname(name);\n\n      this._closeCurrentTag();\n    }\n  } else if (!this._options.xmlMode && (name === \"br\" || name === \"p\")) {\n    this.onopentagname(name);\n\n    this._closeCurrentTag();\n  }\n};\n\nParser.prototype.onselfclosingtag = function () {\n  if (this._options.xmlMode || this._options.recognizeSelfClosing) {\n    this._closeCurrentTag();\n  } else {\n    this.onopentagend();\n  }\n};\n\nParser.prototype._closeCurrentTag = function () {\n  var name = this._tagname;\n  this.onopentagend(); //self-closing tags will be on the top of the stack\n  //(cheaper check than in onclosetag)\n\n  if (this._stack[this._stack.length - 1] === name) {\n    if (this._cbs.onclosetag) {\n      this._cbs.onclosetag(name);\n    }\n\n    this._stack.pop();\n  }\n};\n\nParser.prototype.onattribname = function (name) {\n  if (this._lowerCaseAttributeNames) {\n    name = name.toLowerCase();\n  }\n\n  this._attribname = name;\n};\n\nParser.prototype.onattribdata = function (value) {\n  this._attribvalue += value;\n};\n\nParser.prototype.onattribend = function () {\n  if (this._cbs.onattribute) this._cbs.onattribute(this._attribname, this._attribvalue);\n\n  if (this._attribs && !Object.prototype.hasOwnProperty.call(this._attribs, this._attribname)) {\n    this._attribs[this._attribname] = this._attribvalue;\n  }\n\n  this._attribname = \"\";\n  this._attribvalue = \"\";\n};\n\nParser.prototype._getInstructionName = function (value) {\n  var idx = value.search(re_nameEnd),\n      name = idx < 0 ? value : value.substr(0, idx);\n\n  if (this._lowerCaseTagNames) {\n    name = name.toLowerCase();\n  }\n\n  return name;\n};\n\nParser.prototype.ondeclaration = function (value) {\n  if (this._cbs.onprocessinginstruction) {\n    var name = this._getInstructionName(value);\n\n    this._cbs.onprocessinginstruction(\"!\" + name, \"!\" + value);\n  }\n};\n\nParser.prototype.onprocessinginstruction = function (value) {\n  if (this._cbs.onprocessinginstruction) {\n    var name = this._getInstructionName(value);\n\n    this._cbs.onprocessinginstruction(\"?\" + name, \"?\" + value);\n  }\n};\n\nParser.prototype.oncomment = function (value) {\n  this._updatePosition(4);\n\n  if (this._cbs.oncomment) this._cbs.oncomment(value);\n  if (this._cbs.oncommentend) this._cbs.oncommentend();\n};\n\nParser.prototype.oncdata = function (value) {\n  this._updatePosition(1);\n\n  if (this._options.xmlMode || this._options.recognizeCDATA) {\n    if (this._cbs.oncdatastart) this._cbs.oncdatastart();\n    if (this._cbs.ontext) this._cbs.ontext(value);\n    if (this._cbs.oncdataend) this._cbs.oncdataend();\n  } else {\n    this.oncomment(\"[CDATA[\" + value + \"]]\");\n  }\n};\n\nParser.prototype.onerror = function (err) {\n  if (this._cbs.onerror) this._cbs.onerror(err);\n};\n\nParser.prototype.onend = function () {\n  if (this._cbs.onclosetag) {\n    for (var i = this._stack.length; i > 0; this._cbs.onclosetag(this._stack[--i]));\n  }\n\n  if (this._cbs.onend) this._cbs.onend();\n}; //Resets the parser to a blank state, ready to parse a new HTML document\n\n\nParser.prototype.reset = function () {\n  if (this._cbs.onreset) this._cbs.onreset();\n\n  this._tokenizer.reset();\n\n  this._tagname = \"\";\n  this._attribname = \"\";\n  this._attribs = null;\n  this._stack = [];\n  if (this._cbs.onparserinit) this._cbs.onparserinit(this);\n}; //Parses a complete HTML document and pushes it to the handler\n\n\nParser.prototype.parseComplete = function (data) {\n  this.reset();\n  this.end(data);\n};\n\nParser.prototype.write = function (chunk) {\n  this._tokenizer.write(chunk);\n};\n\nParser.prototype.end = function (chunk) {\n  this._tokenizer.end(chunk);\n};\n\nParser.prototype.pause = function () {\n  this._tokenizer.pause();\n};\n\nParser.prototype.resume = function () {\n  this._tokenizer.resume();\n}; //alias for backwards compat\n\n\nParser.prototype.parseChunk = Parser.prototype.write;\nParser.prototype.done = Parser.prototype.end;\nmodule.exports = Parser;","map":{"version":3,"sources":["/Users/william/Dev/quicksilver/src/client/node_modules/cheerio/node_modules/htmlparser2/lib/Parser.js"],"names":["Tokenizer","require","formTags","input","option","optgroup","select","button","datalist","textarea","openImpliesClose","tr","th","td","thead","body","head","link","script","li","p","h1","h2","h3","h4","h5","h6","output","voidElements","__proto__","area","base","basefont","br","col","command","embed","frame","hr","img","isindex","keygen","meta","param","source","track","wbr","path","circle","ellipse","line","rect","use","stop","polyline","polygon","re_nameEnd","Parser","cbs","options","_options","_cbs","_tagname","_attribname","_attribvalue","_attribs","_stack","startIndex","endIndex","_lowerCaseTagNames","lowerCaseTags","xmlMode","_lowerCaseAttributeNames","lowerCaseAttributeNames","_tokenizer","onparserinit","inherits","EventEmitter","prototype","_updatePosition","initialOffset","_sectionStart","getAbsoluteIndex","ontext","data","onopentagname","name","toLowerCase","el","length","onclosetag","push","onopentag","onopentagend","pos","lastIndexOf","pop","_closeCurrentTag","onselfclosingtag","recognizeSelfClosing","onattribname","onattribdata","value","onattribend","onattribute","Object","hasOwnProperty","call","_getInstructionName","idx","search","substr","ondeclaration","onprocessinginstruction","oncomment","oncommentend","oncdata","recognizeCDATA","oncdatastart","oncdataend","onerror","err","onend","i","reset","onreset","parseComplete","end","write","chunk","pause","resume","parseChunk","done","module","exports"],"mappings":"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","sourcesContent":["var Tokenizer = require(\"./Tokenizer.js\");\n\n/*\n\tOptions:\n\n\txmlMode: Disables the special behavior for script/style tags (false by default)\n\tlowerCaseAttributeNames: call .toLowerCase for each attribute name (true if xmlMode is `false`)\n\tlowerCaseTags: call .toLowerCase for each tag name (true if xmlMode is `false`)\n*/\n\n/*\n\tCallbacks:\n\n\toncdataend,\n\toncdatastart,\n\tonclosetag,\n\toncomment,\n\toncommentend,\n\tonerror,\n\tonopentag,\n\tonprocessinginstruction,\n\tonreset,\n\tontext\n*/\n\nvar formTags = {\n\tinput: true,\n\toption: true,\n\toptgroup: true,\n\tselect: true,\n\tbutton: true,\n\tdatalist: true,\n\ttextarea: true\n};\n\nvar openImpliesClose = {\n\ttr      : { tr:true, th:true, td:true },\n\tth      : { th:true },\n\ttd      : { thead:true, th:true, td:true },\n\tbody    : { head:true, link:true, script:true },\n\tli      : { li:true },\n\tp       : { p:true },\n\th1      : { p:true },\n\th2      : { p:true },\n\th3      : { p:true },\n\th4      : { p:true },\n\th5      : { p:true },\n\th6      : { p:true },\n\tselect  : formTags,\n\tinput   : formTags,\n\toutput  : formTags,\n\tbutton  : formTags,\n\tdatalist: formTags,\n\ttextarea: formTags,\n\toption  : { option:true },\n\toptgroup: { optgroup:true }\n};\n\nvar voidElements = {\n\t__proto__: null,\n\tarea: true,\n\tbase: true,\n\tbasefont: true,\n\tbr: true,\n\tcol: true,\n\tcommand: true,\n\tembed: true,\n\tframe: true,\n\thr: true,\n\timg: true,\n\tinput: true,\n\tisindex: true,\n\tkeygen: true,\n\tlink: true,\n\tmeta: true,\n\tparam: true,\n\tsource: true,\n\ttrack: true,\n\twbr: true,\n\n\t//common self closing svg elements\n\tpath: true,\n\tcircle: true,\n\tellipse: true,\n\tline: true,\n\trect: true,\n\tuse: true,\n\tstop: true,\n\tpolyline: true,\n\tpolygon: true\n};\n\nvar re_nameEnd = /\\s|\\//;\n\nfunction Parser(cbs, options){\n\tthis._options = options || {};\n\tthis._cbs = cbs || {};\n\n\tthis._tagname = \"\";\n\tthis._attribname = \"\";\n\tthis._attribvalue = \"\";\n\tthis._attribs = null;\n\tthis._stack = [];\n\n\tthis.startIndex = 0;\n\tthis.endIndex = null;\n\n\tthis._lowerCaseTagNames = \"lowerCaseTags\" in this._options ?\n\t\t\t\t\t\t\t\t\t!!this._options.lowerCaseTags :\n\t\t\t\t\t\t\t\t\t!this._options.xmlMode;\n\tthis._lowerCaseAttributeNames = \"lowerCaseAttributeNames\" in this._options ?\n\t\t\t\t\t\t\t\t\t!!this._options.lowerCaseAttributeNames :\n\t\t\t\t\t\t\t\t\t!this._options.xmlMode;\n\n\tthis._tokenizer = new Tokenizer(this._options, this);\n\n\tif(this._cbs.onparserinit) this._cbs.onparserinit(this);\n}\n\nrequire(\"util\").inherits(Parser, require(\"events\").EventEmitter);\n\nParser.prototype._updatePosition = function(initialOffset){\n\tif(this.endIndex === null){\n\t\tif(this._tokenizer._sectionStart <= initialOffset){\n\t\t\tthis.startIndex = 0;\n\t\t} else {\n\t\t\tthis.startIndex = this._tokenizer._sectionStart - initialOffset;\n\t\t}\n\t}\n\telse this.startIndex = this.endIndex + 1;\n\tthis.endIndex = this._tokenizer.getAbsoluteIndex();\n};\n\n//Tokenizer event handlers\nParser.prototype.ontext = function(data){\n\tthis._updatePosition(1);\n\tthis.endIndex--;\n\n\tif(this._cbs.ontext) this._cbs.ontext(data);\n};\n\nParser.prototype.onopentagname = function(name){\n\tif(this._lowerCaseTagNames){\n\t\tname = name.toLowerCase();\n\t}\n\n\tthis._tagname = name;\n\n\tif(!this._options.xmlMode && name in openImpliesClose) {\n\t\tfor(\n\t\t\tvar el;\n\t\t\t(el = this._stack[this._stack.length - 1]) in openImpliesClose[name];\n\t\t\tthis.onclosetag(el)\n\t\t);\n\t}\n\n\tif(this._options.xmlMode || !(name in voidElements)){\n\t\tthis._stack.push(name);\n\t}\n\n\tif(this._cbs.onopentagname) this._cbs.onopentagname(name);\n\tif(this._cbs.onopentag) this._attribs = {};\n};\n\nParser.prototype.onopentagend = function(){\n\tthis._updatePosition(1);\n\n\tif(this._attribs){\n\t\tif(this._cbs.onopentag) this._cbs.onopentag(this._tagname, this._attribs);\n\t\tthis._attribs = null;\n\t}\n\n\tif(!this._options.xmlMode && this._cbs.onclosetag && this._tagname in voidElements){\n\t\tthis._cbs.onclosetag(this._tagname);\n\t}\n\n\tthis._tagname = \"\";\n};\n\nParser.prototype.onclosetag = function(name){\n\tthis._updatePosition(1);\n\n\tif(this._lowerCaseTagNames){\n\t\tname = name.toLowerCase();\n\t}\n\n\tif(this._stack.length && (!(name in voidElements) || this._options.xmlMode)){\n\t\tvar pos = this._stack.lastIndexOf(name);\n\t\tif(pos !== -1){\n\t\t\tif(this._cbs.onclosetag){\n\t\t\t\tpos = this._stack.length - pos;\n\t\t\t\twhile(pos--) this._cbs.onclosetag(this._stack.pop());\n\t\t\t}\n\t\t\telse this._stack.length = pos;\n\t\t} else if(name === \"p\" && !this._options.xmlMode){\n\t\t\tthis.onopentagname(name);\n\t\t\tthis._closeCurrentTag();\n\t\t}\n\t} else if(!this._options.xmlMode && (name === \"br\" || name === \"p\")){\n\t\tthis.onopentagname(name);\n\t\tthis._closeCurrentTag();\n\t}\n};\n\nParser.prototype.onselfclosingtag = function(){\n\tif(this._options.xmlMode || this._options.recognizeSelfClosing){\n\t\tthis._closeCurrentTag();\n\t} else {\n\t\tthis.onopentagend();\n\t}\n};\n\nParser.prototype._closeCurrentTag = function(){\n\tvar name = this._tagname;\n\n\tthis.onopentagend();\n\n\t//self-closing tags will be on the top of the stack\n\t//(cheaper check than in onclosetag)\n\tif(this._stack[this._stack.length - 1] === name){\n\t\tif(this._cbs.onclosetag){\n\t\t\tthis._cbs.onclosetag(name);\n\t\t}\n\t\tthis._stack.pop();\n\t}\n};\n\nParser.prototype.onattribname = function(name){\n\tif(this._lowerCaseAttributeNames){\n\t\tname = name.toLowerCase();\n\t}\n\tthis._attribname = name;\n};\n\nParser.prototype.onattribdata = function(value){\n\tthis._attribvalue += value;\n};\n\nParser.prototype.onattribend = function(){\n\tif(this._cbs.onattribute) this._cbs.onattribute(this._attribname, this._attribvalue);\n\tif(\n\t\tthis._attribs &&\n\t\t!Object.prototype.hasOwnProperty.call(this._attribs, this._attribname)\n\t){\n\t\tthis._attribs[this._attribname] = this._attribvalue;\n\t}\n\tthis._attribname = \"\";\n\tthis._attribvalue = \"\";\n};\n\nParser.prototype._getInstructionName = function(value){\n\tvar idx = value.search(re_nameEnd),\n\t    name = idx < 0 ? value : value.substr(0, idx);\n\n\tif(this._lowerCaseTagNames){\n\t\tname = name.toLowerCase();\n\t}\n\n\treturn name;\n};\n\nParser.prototype.ondeclaration = function(value){\n\tif(this._cbs.onprocessinginstruction){\n\t\tvar name = this._getInstructionName(value);\n\t\tthis._cbs.onprocessinginstruction(\"!\" + name, \"!\" + value);\n\t}\n};\n\nParser.prototype.onprocessinginstruction = function(value){\n\tif(this._cbs.onprocessinginstruction){\n\t\tvar name = this._getInstructionName(value);\n\t\tthis._cbs.onprocessinginstruction(\"?\" + name, \"?\" + value);\n\t}\n};\n\nParser.prototype.oncomment = function(value){\n\tthis._updatePosition(4);\n\n\tif(this._cbs.oncomment) this._cbs.oncomment(value);\n\tif(this._cbs.oncommentend) this._cbs.oncommentend();\n};\n\nParser.prototype.oncdata = function(value){\n\tthis._updatePosition(1);\n\n\tif(this._options.xmlMode || this._options.recognizeCDATA){\n\t\tif(this._cbs.oncdatastart) this._cbs.oncdatastart();\n\t\tif(this._cbs.ontext) this._cbs.ontext(value);\n\t\tif(this._cbs.oncdataend) this._cbs.oncdataend();\n\t} else {\n\t\tthis.oncomment(\"[CDATA[\" + value + \"]]\");\n\t}\n};\n\nParser.prototype.onerror = function(err){\n\tif(this._cbs.onerror) this._cbs.onerror(err);\n};\n\nParser.prototype.onend = function(){\n\tif(this._cbs.onclosetag){\n\t\tfor(\n\t\t\tvar i = this._stack.length;\n\t\t\ti > 0;\n\t\t\tthis._cbs.onclosetag(this._stack[--i])\n\t\t);\n\t}\n\tif(this._cbs.onend) this._cbs.onend();\n};\n\n\n//Resets the parser to a blank state, ready to parse a new HTML document\nParser.prototype.reset = function(){\n\tif(this._cbs.onreset) this._cbs.onreset();\n\tthis._tokenizer.reset();\n\n\tthis._tagname = \"\";\n\tthis._attribname = \"\";\n\tthis._attribs = null;\n\tthis._stack = [];\n\n\tif(this._cbs.onparserinit) this._cbs.onparserinit(this);\n};\n\n//Parses a complete HTML document and pushes it to the handler\nParser.prototype.parseComplete = function(data){\n\tthis.reset();\n\tthis.end(data);\n};\n\nParser.prototype.write = function(chunk){\n\tthis._tokenizer.write(chunk);\n};\n\nParser.prototype.end = function(chunk){\n\tthis._tokenizer.end(chunk);\n};\n\nParser.prototype.pause = function(){\n\tthis._tokenizer.pause();\n};\n\nParser.prototype.resume = function(){\n\tthis._tokenizer.resume();\n};\n\n//alias for backwards compat\nParser.prototype.parseChunk = Parser.prototype.write;\nParser.prototype.done = Parser.prototype.end;\n\nmodule.exports = Parser;\n"]},"metadata":{},"sourceType":"script"}