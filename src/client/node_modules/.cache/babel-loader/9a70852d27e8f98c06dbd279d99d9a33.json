{"ast":null,"code":"module.exports = Tokenizer;\n\nvar decodeCodePoint = require(\"entities/lib/decode_codepoint.js\"),\n    entityMap = require(\"entities/maps/entities.json\"),\n    legacyMap = require(\"entities/maps/legacy.json\"),\n    xmlMap = require(\"entities/maps/xml.json\"),\n    i = 0,\n    TEXT = i++,\n    BEFORE_TAG_NAME = i++,\n    //after <\nIN_TAG_NAME = i++,\n    IN_SELF_CLOSING_TAG = i++,\n    BEFORE_CLOSING_TAG_NAME = i++,\n    IN_CLOSING_TAG_NAME = i++,\n    AFTER_CLOSING_TAG_NAME = i++,\n    //attributes\nBEFORE_ATTRIBUTE_NAME = i++,\n    IN_ATTRIBUTE_NAME = i++,\n    AFTER_ATTRIBUTE_NAME = i++,\n    BEFORE_ATTRIBUTE_VALUE = i++,\n    IN_ATTRIBUTE_VALUE_DQ = i++,\n    // \"\nIN_ATTRIBUTE_VALUE_SQ = i++,\n    // '\nIN_ATTRIBUTE_VALUE_NQ = i++,\n    //declarations\nBEFORE_DECLARATION = i++,\n    // !\nIN_DECLARATION = i++,\n    //processing instructions\nIN_PROCESSING_INSTRUCTION = i++,\n    // ?\n//comments\nBEFORE_COMMENT = i++,\n    IN_COMMENT = i++,\n    AFTER_COMMENT_1 = i++,\n    AFTER_COMMENT_2 = i++,\n    //cdata\nBEFORE_CDATA_1 = i++,\n    // [\nBEFORE_CDATA_2 = i++,\n    // C\nBEFORE_CDATA_3 = i++,\n    // D\nBEFORE_CDATA_4 = i++,\n    // A\nBEFORE_CDATA_5 = i++,\n    // T\nBEFORE_CDATA_6 = i++,\n    // A\nIN_CDATA = i++,\n    // [\nAFTER_CDATA_1 = i++,\n    // ]\nAFTER_CDATA_2 = i++,\n    // ]\n//special tags\nBEFORE_SPECIAL = i++,\n    //S\nBEFORE_SPECIAL_END = i++,\n    //S\nBEFORE_SCRIPT_1 = i++,\n    //C\nBEFORE_SCRIPT_2 = i++,\n    //R\nBEFORE_SCRIPT_3 = i++,\n    //I\nBEFORE_SCRIPT_4 = i++,\n    //P\nBEFORE_SCRIPT_5 = i++,\n    //T\nAFTER_SCRIPT_1 = i++,\n    //C\nAFTER_SCRIPT_2 = i++,\n    //R\nAFTER_SCRIPT_3 = i++,\n    //I\nAFTER_SCRIPT_4 = i++,\n    //P\nAFTER_SCRIPT_5 = i++,\n    //T\nBEFORE_STYLE_1 = i++,\n    //T\nBEFORE_STYLE_2 = i++,\n    //Y\nBEFORE_STYLE_3 = i++,\n    //L\nBEFORE_STYLE_4 = i++,\n    //E\nAFTER_STYLE_1 = i++,\n    //T\nAFTER_STYLE_2 = i++,\n    //Y\nAFTER_STYLE_3 = i++,\n    //L\nAFTER_STYLE_4 = i++,\n    //E\nBEFORE_ENTITY = i++,\n    //&\nBEFORE_NUMERIC_ENTITY = i++,\n    //#\nIN_NAMED_ENTITY = i++,\n    IN_NUMERIC_ENTITY = i++,\n    IN_HEX_ENTITY = i++,\n    //X\nj = 0,\n    SPECIAL_NONE = j++,\n    SPECIAL_SCRIPT = j++,\n    SPECIAL_STYLE = j++;\n\nfunction whitespace(c) {\n  return c === \" \" || c === \"\\n\" || c === \"\\t\" || c === \"\\f\" || c === \"\\r\";\n}\n\nfunction characterState(char, SUCCESS) {\n  return function (c) {\n    if (c === char) this._state = SUCCESS;\n  };\n}\n\nfunction ifElseState(upper, SUCCESS, FAILURE) {\n  var lower = upper.toLowerCase();\n\n  if (upper === lower) {\n    return function (c) {\n      if (c === lower) {\n        this._state = SUCCESS;\n      } else {\n        this._state = FAILURE;\n        this._index--;\n      }\n    };\n  } else {\n    return function (c) {\n      if (c === lower || c === upper) {\n        this._state = SUCCESS;\n      } else {\n        this._state = FAILURE;\n        this._index--;\n      }\n    };\n  }\n}\n\nfunction consumeSpecialNameChar(upper, NEXT_STATE) {\n  var lower = upper.toLowerCase();\n  return function (c) {\n    if (c === lower || c === upper) {\n      this._state = NEXT_STATE;\n    } else {\n      this._state = IN_TAG_NAME;\n      this._index--; //consume the token again\n    }\n  };\n}\n\nfunction Tokenizer(options, cbs) {\n  this._state = TEXT;\n  this._buffer = \"\";\n  this._sectionStart = 0;\n  this._index = 0;\n  this._bufferOffset = 0; //chars removed from _buffer\n\n  this._baseState = TEXT;\n  this._special = SPECIAL_NONE;\n  this._cbs = cbs;\n  this._running = true;\n  this._ended = false;\n  this._xmlMode = !!(options && options.xmlMode);\n  this._decodeEntities = !!(options && options.decodeEntities);\n}\n\nTokenizer.prototype._stateText = function (c) {\n  if (c === \"<\") {\n    if (this._index > this._sectionStart) {\n      this._cbs.ontext(this._getSection());\n    }\n\n    this._state = BEFORE_TAG_NAME;\n    this._sectionStart = this._index;\n  } else if (this._decodeEntities && this._special === SPECIAL_NONE && c === \"&\") {\n    if (this._index > this._sectionStart) {\n      this._cbs.ontext(this._getSection());\n    }\n\n    this._baseState = TEXT;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateBeforeTagName = function (c) {\n  if (c === \"/\") {\n    this._state = BEFORE_CLOSING_TAG_NAME;\n  } else if (c === \">\" || this._special !== SPECIAL_NONE || whitespace(c)) {\n    this._state = TEXT;\n  } else if (c === \"!\") {\n    this._state = BEFORE_DECLARATION;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"?\") {\n    this._state = IN_PROCESSING_INSTRUCTION;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"<\") {\n    this._cbs.ontext(this._getSection());\n\n    this._sectionStart = this._index;\n  } else {\n    this._state = !this._xmlMode && (c === \"s\" || c === \"S\") ? BEFORE_SPECIAL : IN_TAG_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInTagName = function (c) {\n  if (c === \"/\" || c === \">\" || whitespace(c)) {\n    this._emitToken(\"onopentagname\");\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateBeforeCloseingTagName = function (c) {\n  if (whitespace(c)) ;else if (c === \">\") {\n    this._state = TEXT;\n  } else if (this._special !== SPECIAL_NONE) {\n    if (c === \"s\" || c === \"S\") {\n      this._state = BEFORE_SPECIAL_END;\n    } else {\n      this._state = TEXT;\n      this._index--;\n    }\n  } else {\n    this._state = IN_CLOSING_TAG_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInCloseingTagName = function (c) {\n  if (c === \">\" || whitespace(c)) {\n    this._emitToken(\"onclosetag\");\n\n    this._state = AFTER_CLOSING_TAG_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateAfterCloseingTagName = function (c) {\n  //skip everything until \">\"\n  if (c === \">\") {\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  }\n};\n\nTokenizer.prototype._stateBeforeAttributeName = function (c) {\n  if (c === \">\") {\n    this._cbs.onopentagend();\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"/\") {\n    this._state = IN_SELF_CLOSING_TAG;\n  } else if (!whitespace(c)) {\n    this._state = IN_ATTRIBUTE_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInSelfClosingTag = function (c) {\n  if (c === \">\") {\n    this._cbs.onselfclosingtag();\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (!whitespace(c)) {\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateInAttributeName = function (c) {\n  if (c === \"=\" || c === \"/\" || c === \">\" || whitespace(c)) {\n    this._cbs.onattribname(this._getSection());\n\n    this._sectionStart = -1;\n    this._state = AFTER_ATTRIBUTE_NAME;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateAfterAttributeName = function (c) {\n  if (c === \"=\") {\n    this._state = BEFORE_ATTRIBUTE_VALUE;\n  } else if (c === \"/\" || c === \">\") {\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  } else if (!whitespace(c)) {\n    this._cbs.onattribend();\n\n    this._state = IN_ATTRIBUTE_NAME;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateBeforeAttributeValue = function (c) {\n  if (c === \"\\\"\") {\n    this._state = IN_ATTRIBUTE_VALUE_DQ;\n    this._sectionStart = this._index + 1;\n  } else if (c === \"'\") {\n    this._state = IN_ATTRIBUTE_VALUE_SQ;\n    this._sectionStart = this._index + 1;\n  } else if (!whitespace(c)) {\n    this._state = IN_ATTRIBUTE_VALUE_NQ;\n    this._sectionStart = this._index;\n    this._index--; //reconsume token\n  }\n};\n\nTokenizer.prototype._stateInAttributeValueDoubleQuotes = function (c) {\n  if (c === \"\\\"\") {\n    this._emitToken(\"onattribdata\");\n\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n  } else if (this._decodeEntities && c === \"&\") {\n    this._emitToken(\"onattribdata\");\n\n    this._baseState = this._state;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInAttributeValueSingleQuotes = function (c) {\n  if (c === \"'\") {\n    this._emitToken(\"onattribdata\");\n\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n  } else if (this._decodeEntities && c === \"&\") {\n    this._emitToken(\"onattribdata\");\n\n    this._baseState = this._state;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateInAttributeValueNoQuotes = function (c) {\n  if (whitespace(c) || c === \">\") {\n    this._emitToken(\"onattribdata\");\n\n    this._cbs.onattribend();\n\n    this._state = BEFORE_ATTRIBUTE_NAME;\n    this._index--;\n  } else if (this._decodeEntities && c === \"&\") {\n    this._emitToken(\"onattribdata\");\n\n    this._baseState = this._state;\n    this._state = BEFORE_ENTITY;\n    this._sectionStart = this._index;\n  }\n};\n\nTokenizer.prototype._stateBeforeDeclaration = function (c) {\n  this._state = c === \"[\" ? BEFORE_CDATA_1 : c === \"-\" ? BEFORE_COMMENT : IN_DECLARATION;\n};\n\nTokenizer.prototype._stateInDeclaration = function (c) {\n  if (c === \">\") {\n    this._cbs.ondeclaration(this._getSection());\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  }\n};\n\nTokenizer.prototype._stateInProcessingInstruction = function (c) {\n  if (c === \">\") {\n    this._cbs.onprocessinginstruction(this._getSection());\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  }\n};\n\nTokenizer.prototype._stateBeforeComment = function (c) {\n  if (c === \"-\") {\n    this._state = IN_COMMENT;\n    this._sectionStart = this._index + 1;\n  } else {\n    this._state = IN_DECLARATION;\n  }\n};\n\nTokenizer.prototype._stateInComment = function (c) {\n  if (c === \"-\") this._state = AFTER_COMMENT_1;\n};\n\nTokenizer.prototype._stateAfterComment1 = function (c) {\n  if (c === \"-\") {\n    this._state = AFTER_COMMENT_2;\n  } else {\n    this._state = IN_COMMENT;\n  }\n};\n\nTokenizer.prototype._stateAfterComment2 = function (c) {\n  if (c === \">\") {\n    //remove 2 trailing chars\n    this._cbs.oncomment(this._buffer.substring(this._sectionStart, this._index - 2));\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (c !== \"-\") {\n    this._state = IN_COMMENT;\n  } // else: stay in AFTER_COMMENT_2 (`--->`)\n\n};\n\nTokenizer.prototype._stateBeforeCdata1 = ifElseState(\"C\", BEFORE_CDATA_2, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata2 = ifElseState(\"D\", BEFORE_CDATA_3, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata3 = ifElseState(\"A\", BEFORE_CDATA_4, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata4 = ifElseState(\"T\", BEFORE_CDATA_5, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata5 = ifElseState(\"A\", BEFORE_CDATA_6, IN_DECLARATION);\n\nTokenizer.prototype._stateBeforeCdata6 = function (c) {\n  if (c === \"[\") {\n    this._state = IN_CDATA;\n    this._sectionStart = this._index + 1;\n  } else {\n    this._state = IN_DECLARATION;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateInCdata = function (c) {\n  if (c === \"]\") this._state = AFTER_CDATA_1;\n};\n\nTokenizer.prototype._stateAfterCdata1 = characterState(\"]\", AFTER_CDATA_2);\n\nTokenizer.prototype._stateAfterCdata2 = function (c) {\n  if (c === \">\") {\n    //remove 2 trailing chars\n    this._cbs.oncdata(this._buffer.substring(this._sectionStart, this._index - 2));\n\n    this._state = TEXT;\n    this._sectionStart = this._index + 1;\n  } else if (c !== \"]\") {\n    this._state = IN_CDATA;\n  } //else: stay in AFTER_CDATA_2 (`]]]>`)\n\n};\n\nTokenizer.prototype._stateBeforeSpecial = function (c) {\n  if (c === \"c\" || c === \"C\") {\n    this._state = BEFORE_SCRIPT_1;\n  } else if (c === \"t\" || c === \"T\") {\n    this._state = BEFORE_STYLE_1;\n  } else {\n    this._state = IN_TAG_NAME;\n    this._index--; //consume the token again\n  }\n};\n\nTokenizer.prototype._stateBeforeSpecialEnd = function (c) {\n  if (this._special === SPECIAL_SCRIPT && (c === \"c\" || c === \"C\")) {\n    this._state = AFTER_SCRIPT_1;\n  } else if (this._special === SPECIAL_STYLE && (c === \"t\" || c === \"T\")) {\n    this._state = AFTER_STYLE_1;\n  } else this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeScript1 = consumeSpecialNameChar(\"R\", BEFORE_SCRIPT_2);\nTokenizer.prototype._stateBeforeScript2 = consumeSpecialNameChar(\"I\", BEFORE_SCRIPT_3);\nTokenizer.prototype._stateBeforeScript3 = consumeSpecialNameChar(\"P\", BEFORE_SCRIPT_4);\nTokenizer.prototype._stateBeforeScript4 = consumeSpecialNameChar(\"T\", BEFORE_SCRIPT_5);\n\nTokenizer.prototype._stateBeforeScript5 = function (c) {\n  if (c === \"/\" || c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_SCRIPT;\n  }\n\n  this._state = IN_TAG_NAME;\n  this._index--; //consume the token again\n};\n\nTokenizer.prototype._stateAfterScript1 = ifElseState(\"R\", AFTER_SCRIPT_2, TEXT);\nTokenizer.prototype._stateAfterScript2 = ifElseState(\"I\", AFTER_SCRIPT_3, TEXT);\nTokenizer.prototype._stateAfterScript3 = ifElseState(\"P\", AFTER_SCRIPT_4, TEXT);\nTokenizer.prototype._stateAfterScript4 = ifElseState(\"T\", AFTER_SCRIPT_5, TEXT);\n\nTokenizer.prototype._stateAfterScript5 = function (c) {\n  if (c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_NONE;\n    this._state = IN_CLOSING_TAG_NAME;\n    this._sectionStart = this._index - 6;\n    this._index--; //reconsume the token\n  } else this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeStyle1 = consumeSpecialNameChar(\"Y\", BEFORE_STYLE_2);\nTokenizer.prototype._stateBeforeStyle2 = consumeSpecialNameChar(\"L\", BEFORE_STYLE_3);\nTokenizer.prototype._stateBeforeStyle3 = consumeSpecialNameChar(\"E\", BEFORE_STYLE_4);\n\nTokenizer.prototype._stateBeforeStyle4 = function (c) {\n  if (c === \"/\" || c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_STYLE;\n  }\n\n  this._state = IN_TAG_NAME;\n  this._index--; //consume the token again\n};\n\nTokenizer.prototype._stateAfterStyle1 = ifElseState(\"Y\", AFTER_STYLE_2, TEXT);\nTokenizer.prototype._stateAfterStyle2 = ifElseState(\"L\", AFTER_STYLE_3, TEXT);\nTokenizer.prototype._stateAfterStyle3 = ifElseState(\"E\", AFTER_STYLE_4, TEXT);\n\nTokenizer.prototype._stateAfterStyle4 = function (c) {\n  if (c === \">\" || whitespace(c)) {\n    this._special = SPECIAL_NONE;\n    this._state = IN_CLOSING_TAG_NAME;\n    this._sectionStart = this._index - 5;\n    this._index--; //reconsume the token\n  } else this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeEntity = ifElseState(\"#\", BEFORE_NUMERIC_ENTITY, IN_NAMED_ENTITY);\nTokenizer.prototype._stateBeforeNumericEntity = ifElseState(\"X\", IN_HEX_ENTITY, IN_NUMERIC_ENTITY); //for entities terminated with a semicolon\n\nTokenizer.prototype._parseNamedEntityStrict = function () {\n  //offset = 1\n  if (this._sectionStart + 1 < this._index) {\n    var entity = this._buffer.substring(this._sectionStart + 1, this._index),\n        map = this._xmlMode ? xmlMap : entityMap;\n\n    if (map.hasOwnProperty(entity)) {\n      this._emitPartial(map[entity]);\n\n      this._sectionStart = this._index + 1;\n    }\n  }\n}; //parses legacy entities (without trailing semicolon)\n\n\nTokenizer.prototype._parseLegacyEntity = function () {\n  var start = this._sectionStart + 1,\n      limit = this._index - start;\n  if (limit > 6) limit = 6; //the max length of legacy entities is 6\n\n  while (limit >= 2) {\n    //the min length of legacy entities is 2\n    var entity = this._buffer.substr(start, limit);\n\n    if (legacyMap.hasOwnProperty(entity)) {\n      this._emitPartial(legacyMap[entity]);\n\n      this._sectionStart += limit + 1;\n      return;\n    } else {\n      limit--;\n    }\n  }\n};\n\nTokenizer.prototype._stateInNamedEntity = function (c) {\n  if (c === \";\") {\n    this._parseNamedEntityStrict();\n\n    if (this._sectionStart + 1 < this._index && !this._xmlMode) {\n      this._parseLegacyEntity();\n    }\n\n    this._state = this._baseState;\n  } else if ((c < \"a\" || c > \"z\") && (c < \"A\" || c > \"Z\") && (c < \"0\" || c > \"9\")) {\n    if (this._xmlMode) ;else if (this._sectionStart + 1 === this._index) ;else if (this._baseState !== TEXT) {\n      if (c !== \"=\") {\n        this._parseNamedEntityStrict();\n      }\n    } else {\n      this._parseLegacyEntity();\n    }\n    this._state = this._baseState;\n    this._index--;\n  }\n};\n\nTokenizer.prototype._decodeNumericEntity = function (offset, base) {\n  var sectionStart = this._sectionStart + offset;\n\n  if (sectionStart !== this._index) {\n    //parse entity\n    var entity = this._buffer.substring(sectionStart, this._index);\n\n    var parsed = parseInt(entity, base);\n\n    this._emitPartial(decodeCodePoint(parsed));\n\n    this._sectionStart = this._index;\n  } else {\n    this._sectionStart--;\n  }\n\n  this._state = this._baseState;\n};\n\nTokenizer.prototype._stateInNumericEntity = function (c) {\n  if (c === \";\") {\n    this._decodeNumericEntity(2, 10);\n\n    this._sectionStart++;\n  } else if (c < \"0\" || c > \"9\") {\n    if (!this._xmlMode) {\n      this._decodeNumericEntity(2, 10);\n    } else {\n      this._state = this._baseState;\n    }\n\n    this._index--;\n  }\n};\n\nTokenizer.prototype._stateInHexEntity = function (c) {\n  if (c === \";\") {\n    this._decodeNumericEntity(3, 16);\n\n    this._sectionStart++;\n  } else if ((c < \"a\" || c > \"f\") && (c < \"A\" || c > \"F\") && (c < \"0\" || c > \"9\")) {\n    if (!this._xmlMode) {\n      this._decodeNumericEntity(3, 16);\n    } else {\n      this._state = this._baseState;\n    }\n\n    this._index--;\n  }\n};\n\nTokenizer.prototype._cleanup = function () {\n  if (this._sectionStart < 0) {\n    this._buffer = \"\";\n    this._index = 0;\n    this._bufferOffset += this._index;\n  } else if (this._running) {\n    if (this._state === TEXT) {\n      if (this._sectionStart !== this._index) {\n        this._cbs.ontext(this._buffer.substr(this._sectionStart));\n      }\n\n      this._buffer = \"\";\n      this._index = 0;\n      this._bufferOffset += this._index;\n    } else if (this._sectionStart === this._index) {\n      //the section just started\n      this._buffer = \"\";\n      this._index = 0;\n      this._bufferOffset += this._index;\n    } else {\n      //remove everything unnecessary\n      this._buffer = this._buffer.substr(this._sectionStart);\n      this._index -= this._sectionStart;\n      this._bufferOffset += this._sectionStart;\n    }\n\n    this._sectionStart = 0;\n  }\n}; //TODO make events conditional\n\n\nTokenizer.prototype.write = function (chunk) {\n  if (this._ended) this._cbs.onerror(Error(\".write() after done!\"));\n  this._buffer += chunk;\n\n  this._parse();\n};\n\nTokenizer.prototype._parse = function () {\n  while (this._index < this._buffer.length && this._running) {\n    var c = this._buffer.charAt(this._index);\n\n    if (this._state === TEXT) {\n      this._stateText(c);\n    } else if (this._state === BEFORE_TAG_NAME) {\n      this._stateBeforeTagName(c);\n    } else if (this._state === IN_TAG_NAME) {\n      this._stateInTagName(c);\n    } else if (this._state === BEFORE_CLOSING_TAG_NAME) {\n      this._stateBeforeCloseingTagName(c);\n    } else if (this._state === IN_CLOSING_TAG_NAME) {\n      this._stateInCloseingTagName(c);\n    } else if (this._state === AFTER_CLOSING_TAG_NAME) {\n      this._stateAfterCloseingTagName(c);\n    } else if (this._state === IN_SELF_CLOSING_TAG) {\n      this._stateInSelfClosingTag(c);\n    }\n    /*\n    *\tattributes\n    */\n    else if (this._state === BEFORE_ATTRIBUTE_NAME) {\n        this._stateBeforeAttributeName(c);\n      } else if (this._state === IN_ATTRIBUTE_NAME) {\n        this._stateInAttributeName(c);\n      } else if (this._state === AFTER_ATTRIBUTE_NAME) {\n        this._stateAfterAttributeName(c);\n      } else if (this._state === BEFORE_ATTRIBUTE_VALUE) {\n        this._stateBeforeAttributeValue(c);\n      } else if (this._state === IN_ATTRIBUTE_VALUE_DQ) {\n        this._stateInAttributeValueDoubleQuotes(c);\n      } else if (this._state === IN_ATTRIBUTE_VALUE_SQ) {\n        this._stateInAttributeValueSingleQuotes(c);\n      } else if (this._state === IN_ATTRIBUTE_VALUE_NQ) {\n        this._stateInAttributeValueNoQuotes(c);\n      }\n      /*\n      *\tdeclarations\n      */\n      else if (this._state === BEFORE_DECLARATION) {\n          this._stateBeforeDeclaration(c);\n        } else if (this._state === IN_DECLARATION) {\n          this._stateInDeclaration(c);\n        }\n        /*\n        *\tprocessing instructions\n        */\n        else if (this._state === IN_PROCESSING_INSTRUCTION) {\n            this._stateInProcessingInstruction(c);\n          }\n          /*\n          *\tcomments\n          */\n          else if (this._state === BEFORE_COMMENT) {\n              this._stateBeforeComment(c);\n            } else if (this._state === IN_COMMENT) {\n              this._stateInComment(c);\n            } else if (this._state === AFTER_COMMENT_1) {\n              this._stateAfterComment1(c);\n            } else if (this._state === AFTER_COMMENT_2) {\n              this._stateAfterComment2(c);\n            }\n            /*\n            *\tcdata\n            */\n            else if (this._state === BEFORE_CDATA_1) {\n                this._stateBeforeCdata1(c);\n              } else if (this._state === BEFORE_CDATA_2) {\n                this._stateBeforeCdata2(c);\n              } else if (this._state === BEFORE_CDATA_3) {\n                this._stateBeforeCdata3(c);\n              } else if (this._state === BEFORE_CDATA_4) {\n                this._stateBeforeCdata4(c);\n              } else if (this._state === BEFORE_CDATA_5) {\n                this._stateBeforeCdata5(c);\n              } else if (this._state === BEFORE_CDATA_6) {\n                this._stateBeforeCdata6(c);\n              } else if (this._state === IN_CDATA) {\n                this._stateInCdata(c);\n              } else if (this._state === AFTER_CDATA_1) {\n                this._stateAfterCdata1(c);\n              } else if (this._state === AFTER_CDATA_2) {\n                this._stateAfterCdata2(c);\n              }\n              /*\n              * special tags\n              */\n              else if (this._state === BEFORE_SPECIAL) {\n                  this._stateBeforeSpecial(c);\n                } else if (this._state === BEFORE_SPECIAL_END) {\n                  this._stateBeforeSpecialEnd(c);\n                }\n                /*\n                * script\n                */\n                else if (this._state === BEFORE_SCRIPT_1) {\n                    this._stateBeforeScript1(c);\n                  } else if (this._state === BEFORE_SCRIPT_2) {\n                    this._stateBeforeScript2(c);\n                  } else if (this._state === BEFORE_SCRIPT_3) {\n                    this._stateBeforeScript3(c);\n                  } else if (this._state === BEFORE_SCRIPT_4) {\n                    this._stateBeforeScript4(c);\n                  } else if (this._state === BEFORE_SCRIPT_5) {\n                    this._stateBeforeScript5(c);\n                  } else if (this._state === AFTER_SCRIPT_1) {\n                    this._stateAfterScript1(c);\n                  } else if (this._state === AFTER_SCRIPT_2) {\n                    this._stateAfterScript2(c);\n                  } else if (this._state === AFTER_SCRIPT_3) {\n                    this._stateAfterScript3(c);\n                  } else if (this._state === AFTER_SCRIPT_4) {\n                    this._stateAfterScript4(c);\n                  } else if (this._state === AFTER_SCRIPT_5) {\n                    this._stateAfterScript5(c);\n                  }\n                  /*\n                  * style\n                  */\n                  else if (this._state === BEFORE_STYLE_1) {\n                      this._stateBeforeStyle1(c);\n                    } else if (this._state === BEFORE_STYLE_2) {\n                      this._stateBeforeStyle2(c);\n                    } else if (this._state === BEFORE_STYLE_3) {\n                      this._stateBeforeStyle3(c);\n                    } else if (this._state === BEFORE_STYLE_4) {\n                      this._stateBeforeStyle4(c);\n                    } else if (this._state === AFTER_STYLE_1) {\n                      this._stateAfterStyle1(c);\n                    } else if (this._state === AFTER_STYLE_2) {\n                      this._stateAfterStyle2(c);\n                    } else if (this._state === AFTER_STYLE_3) {\n                      this._stateAfterStyle3(c);\n                    } else if (this._state === AFTER_STYLE_4) {\n                      this._stateAfterStyle4(c);\n                    }\n                    /*\n                    * entities\n                    */\n                    else if (this._state === BEFORE_ENTITY) {\n                        this._stateBeforeEntity(c);\n                      } else if (this._state === BEFORE_NUMERIC_ENTITY) {\n                        this._stateBeforeNumericEntity(c);\n                      } else if (this._state === IN_NAMED_ENTITY) {\n                        this._stateInNamedEntity(c);\n                      } else if (this._state === IN_NUMERIC_ENTITY) {\n                        this._stateInNumericEntity(c);\n                      } else if (this._state === IN_HEX_ENTITY) {\n                        this._stateInHexEntity(c);\n                      } else {\n                        this._cbs.onerror(Error(\"unknown _state\"), this._state);\n                      }\n\n    this._index++;\n  }\n\n  this._cleanup();\n};\n\nTokenizer.prototype.pause = function () {\n  this._running = false;\n};\n\nTokenizer.prototype.resume = function () {\n  this._running = true;\n\n  if (this._index < this._buffer.length) {\n    this._parse();\n  }\n\n  if (this._ended) {\n    this._finish();\n  }\n};\n\nTokenizer.prototype.end = function (chunk) {\n  if (this._ended) this._cbs.onerror(Error(\".end() after done!\"));\n  if (chunk) this.write(chunk);\n  this._ended = true;\n  if (this._running) this._finish();\n};\n\nTokenizer.prototype._finish = function () {\n  //if there is remaining data, emit it in a reasonable way\n  if (this._sectionStart < this._index) {\n    this._handleTrailingData();\n  }\n\n  this._cbs.onend();\n};\n\nTokenizer.prototype._handleTrailingData = function () {\n  var data = this._buffer.substr(this._sectionStart);\n\n  if (this._state === IN_CDATA || this._state === AFTER_CDATA_1 || this._state === AFTER_CDATA_2) {\n    this._cbs.oncdata(data);\n  } else if (this._state === IN_COMMENT || this._state === AFTER_COMMENT_1 || this._state === AFTER_COMMENT_2) {\n    this._cbs.oncomment(data);\n  } else if (this._state === IN_NAMED_ENTITY && !this._xmlMode) {\n    this._parseLegacyEntity();\n\n    if (this._sectionStart < this._index) {\n      this._state = this._baseState;\n\n      this._handleTrailingData();\n    }\n  } else if (this._state === IN_NUMERIC_ENTITY && !this._xmlMode) {\n    this._decodeNumericEntity(2, 10);\n\n    if (this._sectionStart < this._index) {\n      this._state = this._baseState;\n\n      this._handleTrailingData();\n    }\n  } else if (this._state === IN_HEX_ENTITY && !this._xmlMode) {\n    this._decodeNumericEntity(3, 16);\n\n    if (this._sectionStart < this._index) {\n      this._state = this._baseState;\n\n      this._handleTrailingData();\n    }\n  } else if (this._state !== IN_TAG_NAME && this._state !== BEFORE_ATTRIBUTE_NAME && this._state !== BEFORE_ATTRIBUTE_VALUE && this._state !== AFTER_ATTRIBUTE_NAME && this._state !== IN_ATTRIBUTE_NAME && this._state !== IN_ATTRIBUTE_VALUE_SQ && this._state !== IN_ATTRIBUTE_VALUE_DQ && this._state !== IN_ATTRIBUTE_VALUE_NQ && this._state !== IN_CLOSING_TAG_NAME) {\n    this._cbs.ontext(data);\n  } //else, ignore remaining data\n  //TODO add a way to remove current tag\n\n};\n\nTokenizer.prototype.reset = function () {\n  Tokenizer.call(this, {\n    xmlMode: this._xmlMode,\n    decodeEntities: this._decodeEntities\n  }, this._cbs);\n};\n\nTokenizer.prototype.getAbsoluteIndex = function () {\n  return this._bufferOffset + this._index;\n};\n\nTokenizer.prototype._getSection = function () {\n  return this._buffer.substring(this._sectionStart, this._index);\n};\n\nTokenizer.prototype._emitToken = function (name) {\n  this._cbs[name](this._getSection());\n\n  this._sectionStart = -1;\n};\n\nTokenizer.prototype._emitPartial = function (value) {\n  if (this._baseState !== TEXT) {\n    this._cbs.onattribdata(value); //TODO implement the new event\n\n  } else {\n    this._cbs.ontext(value);\n  }\n};","map":{"version":3,"sources":["/Users/william/Dev/quicksilver/node_modules/cheerio/node_modules/htmlparser2/lib/Tokenizer.js"],"names":["module","exports","Tokenizer","decodeCodePoint","require","entityMap","legacyMap","xmlMap","i","TEXT","BEFORE_TAG_NAME","IN_TAG_NAME","IN_SELF_CLOSING_TAG","BEFORE_CLOSING_TAG_NAME","IN_CLOSING_TAG_NAME","AFTER_CLOSING_TAG_NAME","BEFORE_ATTRIBUTE_NAME","IN_ATTRIBUTE_NAME","AFTER_ATTRIBUTE_NAME","BEFORE_ATTRIBUTE_VALUE","IN_ATTRIBUTE_VALUE_DQ","IN_ATTRIBUTE_VALUE_SQ","IN_ATTRIBUTE_VALUE_NQ","BEFORE_DECLARATION","IN_DECLARATION","IN_PROCESSING_INSTRUCTION","BEFORE_COMMENT","IN_COMMENT","AFTER_COMMENT_1","AFTER_COMMENT_2","BEFORE_CDATA_1","BEFORE_CDATA_2","BEFORE_CDATA_3","BEFORE_CDATA_4","BEFORE_CDATA_5","BEFORE_CDATA_6","IN_CDATA","AFTER_CDATA_1","AFTER_CDATA_2","BEFORE_SPECIAL","BEFORE_SPECIAL_END","BEFORE_SCRIPT_1","BEFORE_SCRIPT_2","BEFORE_SCRIPT_3","BEFORE_SCRIPT_4","BEFORE_SCRIPT_5","AFTER_SCRIPT_1","AFTER_SCRIPT_2","AFTER_SCRIPT_3","AFTER_SCRIPT_4","AFTER_SCRIPT_5","BEFORE_STYLE_1","BEFORE_STYLE_2","BEFORE_STYLE_3","BEFORE_STYLE_4","AFTER_STYLE_1","AFTER_STYLE_2","AFTER_STYLE_3","AFTER_STYLE_4","BEFORE_ENTITY","BEFORE_NUMERIC_ENTITY","IN_NAMED_ENTITY","IN_NUMERIC_ENTITY","IN_HEX_ENTITY","j","SPECIAL_NONE","SPECIAL_SCRIPT","SPECIAL_STYLE","whitespace","c","characterState","char","SUCCESS","_state","ifElseState","upper","FAILURE","lower","toLowerCase","_index","consumeSpecialNameChar","NEXT_STATE","options","cbs","_buffer","_sectionStart","_bufferOffset","_baseState","_special","_cbs","_running","_ended","_xmlMode","xmlMode","_decodeEntities","decodeEntities","prototype","_stateText","ontext","_getSection","_stateBeforeTagName","_stateInTagName","_emitToken","_stateBeforeCloseingTagName","_stateInCloseingTagName","_stateAfterCloseingTagName","_stateBeforeAttributeName","onopentagend","_stateInSelfClosingTag","onselfclosingtag","_stateInAttributeName","onattribname","_stateAfterAttributeName","onattribend","_stateBeforeAttributeValue","_stateInAttributeValueDoubleQuotes","_stateInAttributeValueSingleQuotes","_stateInAttributeValueNoQuotes","_stateBeforeDeclaration","_stateInDeclaration","ondeclaration","_stateInProcessingInstruction","onprocessinginstruction","_stateBeforeComment","_stateInComment","_stateAfterComment1","_stateAfterComment2","oncomment","substring","_stateBeforeCdata1","_stateBeforeCdata2","_stateBeforeCdata3","_stateBeforeCdata4","_stateBeforeCdata5","_stateBeforeCdata6","_stateInCdata","_stateAfterCdata1","_stateAfterCdata2","oncdata","_stateBeforeSpecial","_stateBeforeSpecialEnd","_stateBeforeScript1","_stateBeforeScript2","_stateBeforeScript3","_stateBeforeScript4","_stateBeforeScript5","_stateAfterScript1","_stateAfterScript2","_stateAfterScript3","_stateAfterScript4","_stateAfterScript5","_stateBeforeStyle1","_stateBeforeStyle2","_stateBeforeStyle3","_stateBeforeStyle4","_stateAfterStyle1","_stateAfterStyle2","_stateAfterStyle3","_stateAfterStyle4","_stateBeforeEntity","_stateBeforeNumericEntity","_parseNamedEntityStrict","entity","map","hasOwnProperty","_emitPartial","_parseLegacyEntity","start","limit","substr","_stateInNamedEntity","_decodeNumericEntity","offset","base","sectionStart","parsed","parseInt","_stateInNumericEntity","_stateInHexEntity","_cleanup","write","chunk","onerror","Error","_parse","length","charAt","pause","resume","_finish","end","_handleTrailingData","onend","data","reset","call","getAbsoluteIndex","name","value","onattribdata"],"mappings":"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","sourcesContent":["module.exports = Tokenizer;\n\nvar decodeCodePoint = require(\"entities/lib/decode_codepoint.js\"),\n    entityMap = require(\"entities/maps/entities.json\"),\n    legacyMap = require(\"entities/maps/legacy.json\"),\n    xmlMap    = require(\"entities/maps/xml.json\"),\n\n    i = 0,\n\n    TEXT                      = i++,\n    BEFORE_TAG_NAME           = i++, //after <\n    IN_TAG_NAME               = i++,\n    IN_SELF_CLOSING_TAG       = i++,\n    BEFORE_CLOSING_TAG_NAME   = i++,\n    IN_CLOSING_TAG_NAME       = i++,\n    AFTER_CLOSING_TAG_NAME    = i++,\n\n    //attributes\n    BEFORE_ATTRIBUTE_NAME     = i++,\n    IN_ATTRIBUTE_NAME         = i++,\n    AFTER_ATTRIBUTE_NAME      = i++,\n    BEFORE_ATTRIBUTE_VALUE    = i++,\n    IN_ATTRIBUTE_VALUE_DQ     = i++, // \"\n    IN_ATTRIBUTE_VALUE_SQ     = i++, // '\n    IN_ATTRIBUTE_VALUE_NQ     = i++,\n\n    //declarations\n    BEFORE_DECLARATION        = i++, // !\n    IN_DECLARATION            = i++,\n\n    //processing instructions\n    IN_PROCESSING_INSTRUCTION = i++, // ?\n\n    //comments\n    BEFORE_COMMENT            = i++,\n    IN_COMMENT                = i++,\n    AFTER_COMMENT_1           = i++,\n    AFTER_COMMENT_2           = i++,\n\n    //cdata\n    BEFORE_CDATA_1            = i++, // [\n    BEFORE_CDATA_2            = i++, // C\n    BEFORE_CDATA_3            = i++, // D\n    BEFORE_CDATA_4            = i++, // A\n    BEFORE_CDATA_5            = i++, // T\n    BEFORE_CDATA_6            = i++, // A\n    IN_CDATA                  = i++, // [\n    AFTER_CDATA_1             = i++, // ]\n    AFTER_CDATA_2             = i++, // ]\n\n    //special tags\n    BEFORE_SPECIAL            = i++, //S\n    BEFORE_SPECIAL_END        = i++,   //S\n\n    BEFORE_SCRIPT_1           = i++, //C\n    BEFORE_SCRIPT_2           = i++, //R\n    BEFORE_SCRIPT_3           = i++, //I\n    BEFORE_SCRIPT_4           = i++, //P\n    BEFORE_SCRIPT_5           = i++, //T\n    AFTER_SCRIPT_1            = i++, //C\n    AFTER_SCRIPT_2            = i++, //R\n    AFTER_SCRIPT_3            = i++, //I\n    AFTER_SCRIPT_4            = i++, //P\n    AFTER_SCRIPT_5            = i++, //T\n\n    BEFORE_STYLE_1            = i++, //T\n    BEFORE_STYLE_2            = i++, //Y\n    BEFORE_STYLE_3            = i++, //L\n    BEFORE_STYLE_4            = i++, //E\n    AFTER_STYLE_1             = i++, //T\n    AFTER_STYLE_2             = i++, //Y\n    AFTER_STYLE_3             = i++, //L\n    AFTER_STYLE_4             = i++, //E\n\n    BEFORE_ENTITY             = i++, //&\n    BEFORE_NUMERIC_ENTITY     = i++, //#\n    IN_NAMED_ENTITY           = i++,\n    IN_NUMERIC_ENTITY         = i++,\n    IN_HEX_ENTITY             = i++, //X\n\n    j = 0,\n\n    SPECIAL_NONE              = j++,\n    SPECIAL_SCRIPT            = j++,\n    SPECIAL_STYLE             = j++;\n\nfunction whitespace(c){\n\treturn c === \" \" || c === \"\\n\" || c === \"\\t\" || c === \"\\f\" || c === \"\\r\";\n}\n\nfunction characterState(char, SUCCESS){\n\treturn function(c){\n\t\tif(c === char) this._state = SUCCESS;\n\t};\n}\n\nfunction ifElseState(upper, SUCCESS, FAILURE){\n\tvar lower = upper.toLowerCase();\n\n\tif(upper === lower){\n\t\treturn function(c){\n\t\t\tif(c === lower){\n\t\t\t\tthis._state = SUCCESS;\n\t\t\t} else {\n\t\t\t\tthis._state = FAILURE;\n\t\t\t\tthis._index--;\n\t\t\t}\n\t\t};\n\t} else {\n\t\treturn function(c){\n\t\t\tif(c === lower || c === upper){\n\t\t\t\tthis._state = SUCCESS;\n\t\t\t} else {\n\t\t\t\tthis._state = FAILURE;\n\t\t\t\tthis._index--;\n\t\t\t}\n\t\t};\n\t}\n}\n\nfunction consumeSpecialNameChar(upper, NEXT_STATE){\n\tvar lower = upper.toLowerCase();\n\n\treturn function(c){\n\t\tif(c === lower || c === upper){\n\t\t\tthis._state = NEXT_STATE;\n\t\t} else {\n\t\t\tthis._state = IN_TAG_NAME;\n\t\t\tthis._index--; //consume the token again\n\t\t}\n\t};\n}\n\nfunction Tokenizer(options, cbs){\n\tthis._state = TEXT;\n\tthis._buffer = \"\";\n\tthis._sectionStart = 0;\n\tthis._index = 0;\n\tthis._bufferOffset = 0; //chars removed from _buffer\n\tthis._baseState = TEXT;\n\tthis._special = SPECIAL_NONE;\n\tthis._cbs = cbs;\n\tthis._running = true;\n\tthis._ended = false;\n\tthis._xmlMode = !!(options && options.xmlMode);\n\tthis._decodeEntities = !!(options && options.decodeEntities);\n}\n\nTokenizer.prototype._stateText = function(c){\n\tif(c === \"<\"){\n\t\tif(this._index > this._sectionStart){\n\t\t\tthis._cbs.ontext(this._getSection());\n\t\t}\n\t\tthis._state = BEFORE_TAG_NAME;\n\t\tthis._sectionStart = this._index;\n\t} else if(this._decodeEntities && this._special === SPECIAL_NONE && c === \"&\"){\n\t\tif(this._index > this._sectionStart){\n\t\t\tthis._cbs.ontext(this._getSection());\n\t\t}\n\t\tthis._baseState = TEXT;\n\t\tthis._state = BEFORE_ENTITY;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateBeforeTagName = function(c){\n\tif(c === \"/\"){\n\t\tthis._state = BEFORE_CLOSING_TAG_NAME;\n\t} else if(c === \">\" || this._special !== SPECIAL_NONE || whitespace(c)) {\n\t\tthis._state = TEXT;\n\t} else if(c === \"!\"){\n\t\tthis._state = BEFORE_DECLARATION;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(c === \"?\"){\n\t\tthis._state = IN_PROCESSING_INSTRUCTION;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(c === \"<\"){\n\t\tthis._cbs.ontext(this._getSection());\n\t\tthis._sectionStart = this._index;\n\t} else {\n\t\tthis._state = (!this._xmlMode && (c === \"s\" || c === \"S\")) ?\n\t\t\t\t\t\tBEFORE_SPECIAL : IN_TAG_NAME;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateInTagName = function(c){\n\tif(c === \"/\" || c === \">\" || whitespace(c)){\n\t\tthis._emitToken(\"onopentagname\");\n\t\tthis._state = BEFORE_ATTRIBUTE_NAME;\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._stateBeforeCloseingTagName = function(c){\n\tif(whitespace(c));\n\telse if(c === \">\"){\n\t\tthis._state = TEXT;\n\t} else if(this._special !== SPECIAL_NONE){\n\t\tif(c === \"s\" || c === \"S\"){\n\t\t\tthis._state = BEFORE_SPECIAL_END;\n\t\t} else {\n\t\t\tthis._state = TEXT;\n\t\t\tthis._index--;\n\t\t}\n\t} else {\n\t\tthis._state = IN_CLOSING_TAG_NAME;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateInCloseingTagName = function(c){\n\tif(c === \">\" || whitespace(c)){\n\t\tthis._emitToken(\"onclosetag\");\n\t\tthis._state = AFTER_CLOSING_TAG_NAME;\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._stateAfterCloseingTagName = function(c){\n\t//skip everything until \">\"\n\tif(c === \">\"){\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t}\n};\n\nTokenizer.prototype._stateBeforeAttributeName = function(c){\n\tif(c === \">\"){\n\t\tthis._cbs.onopentagend();\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(c === \"/\"){\n\t\tthis._state = IN_SELF_CLOSING_TAG;\n\t} else if(!whitespace(c)){\n\t\tthis._state = IN_ATTRIBUTE_NAME;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateInSelfClosingTag = function(c){\n\tif(c === \">\"){\n\t\tthis._cbs.onselfclosingtag();\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(!whitespace(c)){\n\t\tthis._state = BEFORE_ATTRIBUTE_NAME;\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._stateInAttributeName = function(c){\n\tif(c === \"=\" || c === \"/\" || c === \">\" || whitespace(c)){\n\t\tthis._cbs.onattribname(this._getSection());\n\t\tthis._sectionStart = -1;\n\t\tthis._state = AFTER_ATTRIBUTE_NAME;\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._stateAfterAttributeName = function(c){\n\tif(c === \"=\"){\n\t\tthis._state = BEFORE_ATTRIBUTE_VALUE;\n\t} else if(c === \"/\" || c === \">\"){\n\t\tthis._cbs.onattribend();\n\t\tthis._state = BEFORE_ATTRIBUTE_NAME;\n\t\tthis._index--;\n\t} else if(!whitespace(c)){\n\t\tthis._cbs.onattribend();\n\t\tthis._state = IN_ATTRIBUTE_NAME;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateBeforeAttributeValue = function(c){\n\tif(c === \"\\\"\"){\n\t\tthis._state = IN_ATTRIBUTE_VALUE_DQ;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(c === \"'\"){\n\t\tthis._state = IN_ATTRIBUTE_VALUE_SQ;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(!whitespace(c)){\n\t\tthis._state = IN_ATTRIBUTE_VALUE_NQ;\n\t\tthis._sectionStart = this._index;\n\t\tthis._index--; //reconsume token\n\t}\n};\n\nTokenizer.prototype._stateInAttributeValueDoubleQuotes = function(c){\n\tif(c === \"\\\"\"){\n\t\tthis._emitToken(\"onattribdata\");\n\t\tthis._cbs.onattribend();\n\t\tthis._state = BEFORE_ATTRIBUTE_NAME;\n\t} else if(this._decodeEntities && c === \"&\"){\n\t\tthis._emitToken(\"onattribdata\");\n\t\tthis._baseState = this._state;\n\t\tthis._state = BEFORE_ENTITY;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateInAttributeValueSingleQuotes = function(c){\n\tif(c === \"'\"){\n\t\tthis._emitToken(\"onattribdata\");\n\t\tthis._cbs.onattribend();\n\t\tthis._state = BEFORE_ATTRIBUTE_NAME;\n\t} else if(this._decodeEntities && c === \"&\"){\n\t\tthis._emitToken(\"onattribdata\");\n\t\tthis._baseState = this._state;\n\t\tthis._state = BEFORE_ENTITY;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateInAttributeValueNoQuotes = function(c){\n\tif(whitespace(c) || c === \">\"){\n\t\tthis._emitToken(\"onattribdata\");\n\t\tthis._cbs.onattribend();\n\t\tthis._state = BEFORE_ATTRIBUTE_NAME;\n\t\tthis._index--;\n\t} else if(this._decodeEntities && c === \"&\"){\n\t\tthis._emitToken(\"onattribdata\");\n\t\tthis._baseState = this._state;\n\t\tthis._state = BEFORE_ENTITY;\n\t\tthis._sectionStart = this._index;\n\t}\n};\n\nTokenizer.prototype._stateBeforeDeclaration = function(c){\n\tthis._state = c === \"[\" ? BEFORE_CDATA_1 :\n\t\t\t\t\tc === \"-\" ? BEFORE_COMMENT :\n\t\t\t\t\t\tIN_DECLARATION;\n};\n\nTokenizer.prototype._stateInDeclaration = function(c){\n\tif(c === \">\"){\n\t\tthis._cbs.ondeclaration(this._getSection());\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t}\n};\n\nTokenizer.prototype._stateInProcessingInstruction = function(c){\n\tif(c === \">\"){\n\t\tthis._cbs.onprocessinginstruction(this._getSection());\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t}\n};\n\nTokenizer.prototype._stateBeforeComment = function(c){\n\tif(c === \"-\"){\n\t\tthis._state = IN_COMMENT;\n\t\tthis._sectionStart = this._index + 1;\n\t} else {\n\t\tthis._state = IN_DECLARATION;\n\t}\n};\n\nTokenizer.prototype._stateInComment = function(c){\n\tif(c === \"-\") this._state = AFTER_COMMENT_1;\n};\n\nTokenizer.prototype._stateAfterComment1 = function(c){\n\tif(c === \"-\"){\n\t\tthis._state = AFTER_COMMENT_2;\n\t} else {\n\t\tthis._state = IN_COMMENT;\n\t}\n};\n\nTokenizer.prototype._stateAfterComment2 = function(c){\n\tif(c === \">\"){\n\t\t//remove 2 trailing chars\n\t\tthis._cbs.oncomment(this._buffer.substring(this._sectionStart, this._index - 2));\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(c !== \"-\"){\n\t\tthis._state = IN_COMMENT;\n\t}\n\t// else: stay in AFTER_COMMENT_2 (`--->`)\n};\n\nTokenizer.prototype._stateBeforeCdata1 = ifElseState(\"C\", BEFORE_CDATA_2, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata2 = ifElseState(\"D\", BEFORE_CDATA_3, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata3 = ifElseState(\"A\", BEFORE_CDATA_4, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata4 = ifElseState(\"T\", BEFORE_CDATA_5, IN_DECLARATION);\nTokenizer.prototype._stateBeforeCdata5 = ifElseState(\"A\", BEFORE_CDATA_6, IN_DECLARATION);\n\nTokenizer.prototype._stateBeforeCdata6 = function(c){\n\tif(c === \"[\"){\n\t\tthis._state = IN_CDATA;\n\t\tthis._sectionStart = this._index + 1;\n\t} else {\n\t\tthis._state = IN_DECLARATION;\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._stateInCdata = function(c){\n\tif(c === \"]\") this._state = AFTER_CDATA_1;\n};\n\nTokenizer.prototype._stateAfterCdata1 = characterState(\"]\", AFTER_CDATA_2);\n\nTokenizer.prototype._stateAfterCdata2 = function(c){\n\tif(c === \">\"){\n\t\t//remove 2 trailing chars\n\t\tthis._cbs.oncdata(this._buffer.substring(this._sectionStart, this._index - 2));\n\t\tthis._state = TEXT;\n\t\tthis._sectionStart = this._index + 1;\n\t} else if(c !== \"]\") {\n\t\tthis._state = IN_CDATA;\n\t}\n\t//else: stay in AFTER_CDATA_2 (`]]]>`)\n};\n\nTokenizer.prototype._stateBeforeSpecial = function(c){\n\tif(c === \"c\" || c === \"C\"){\n\t\tthis._state = BEFORE_SCRIPT_1;\n\t} else if(c === \"t\" || c === \"T\"){\n\t\tthis._state = BEFORE_STYLE_1;\n\t} else {\n\t\tthis._state = IN_TAG_NAME;\n\t\tthis._index--; //consume the token again\n\t}\n};\n\nTokenizer.prototype._stateBeforeSpecialEnd = function(c){\n\tif(this._special === SPECIAL_SCRIPT && (c === \"c\" || c === \"C\")){\n\t\tthis._state = AFTER_SCRIPT_1;\n\t} else if(this._special === SPECIAL_STYLE && (c === \"t\" || c === \"T\")){\n\t\tthis._state = AFTER_STYLE_1;\n\t}\n\telse this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeScript1 = consumeSpecialNameChar(\"R\", BEFORE_SCRIPT_2);\nTokenizer.prototype._stateBeforeScript2 = consumeSpecialNameChar(\"I\", BEFORE_SCRIPT_3);\nTokenizer.prototype._stateBeforeScript3 = consumeSpecialNameChar(\"P\", BEFORE_SCRIPT_4);\nTokenizer.prototype._stateBeforeScript4 = consumeSpecialNameChar(\"T\", BEFORE_SCRIPT_5);\n\nTokenizer.prototype._stateBeforeScript5 = function(c){\n\tif(c === \"/\" || c === \">\" || whitespace(c)){\n\t\tthis._special = SPECIAL_SCRIPT;\n\t}\n\tthis._state = IN_TAG_NAME;\n\tthis._index--; //consume the token again\n};\n\nTokenizer.prototype._stateAfterScript1 = ifElseState(\"R\", AFTER_SCRIPT_2, TEXT);\nTokenizer.prototype._stateAfterScript2 = ifElseState(\"I\", AFTER_SCRIPT_3, TEXT);\nTokenizer.prototype._stateAfterScript3 = ifElseState(\"P\", AFTER_SCRIPT_4, TEXT);\nTokenizer.prototype._stateAfterScript4 = ifElseState(\"T\", AFTER_SCRIPT_5, TEXT);\n\nTokenizer.prototype._stateAfterScript5 = function(c){\n\tif(c === \">\" || whitespace(c)){\n\t\tthis._special = SPECIAL_NONE;\n\t\tthis._state = IN_CLOSING_TAG_NAME;\n\t\tthis._sectionStart = this._index - 6;\n\t\tthis._index--; //reconsume the token\n\t}\n\telse this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeStyle1 = consumeSpecialNameChar(\"Y\", BEFORE_STYLE_2);\nTokenizer.prototype._stateBeforeStyle2 = consumeSpecialNameChar(\"L\", BEFORE_STYLE_3);\nTokenizer.prototype._stateBeforeStyle3 = consumeSpecialNameChar(\"E\", BEFORE_STYLE_4);\n\nTokenizer.prototype._stateBeforeStyle4 = function(c){\n\tif(c === \"/\" || c === \">\" || whitespace(c)){\n\t\tthis._special = SPECIAL_STYLE;\n\t}\n\tthis._state = IN_TAG_NAME;\n\tthis._index--; //consume the token again\n};\n\nTokenizer.prototype._stateAfterStyle1 = ifElseState(\"Y\", AFTER_STYLE_2, TEXT);\nTokenizer.prototype._stateAfterStyle2 = ifElseState(\"L\", AFTER_STYLE_3, TEXT);\nTokenizer.prototype._stateAfterStyle3 = ifElseState(\"E\", AFTER_STYLE_4, TEXT);\n\nTokenizer.prototype._stateAfterStyle4 = function(c){\n\tif(c === \">\" || whitespace(c)){\n\t\tthis._special = SPECIAL_NONE;\n\t\tthis._state = IN_CLOSING_TAG_NAME;\n\t\tthis._sectionStart = this._index - 5;\n\t\tthis._index--; //reconsume the token\n\t}\n\telse this._state = TEXT;\n};\n\nTokenizer.prototype._stateBeforeEntity = ifElseState(\"#\", BEFORE_NUMERIC_ENTITY, IN_NAMED_ENTITY);\nTokenizer.prototype._stateBeforeNumericEntity = ifElseState(\"X\", IN_HEX_ENTITY, IN_NUMERIC_ENTITY);\n\n//for entities terminated with a semicolon\nTokenizer.prototype._parseNamedEntityStrict = function(){\n\t//offset = 1\n\tif(this._sectionStart + 1 < this._index){\n\t\tvar entity = this._buffer.substring(this._sectionStart + 1, this._index),\n\t\t    map = this._xmlMode ? xmlMap : entityMap;\n\n\t\tif(map.hasOwnProperty(entity)){\n\t\t\tthis._emitPartial(map[entity]);\n\t\t\tthis._sectionStart = this._index + 1;\n\t\t}\n\t}\n};\n\n\n//parses legacy entities (without trailing semicolon)\nTokenizer.prototype._parseLegacyEntity = function(){\n\tvar start = this._sectionStart + 1,\n\t    limit = this._index - start;\n\n\tif(limit > 6) limit = 6; //the max length of legacy entities is 6\n\n\twhile(limit >= 2){ //the min length of legacy entities is 2\n\t\tvar entity = this._buffer.substr(start, limit);\n\n\t\tif(legacyMap.hasOwnProperty(entity)){\n\t\t\tthis._emitPartial(legacyMap[entity]);\n\t\t\tthis._sectionStart += limit + 1;\n\t\t\treturn;\n\t\t} else {\n\t\t\tlimit--;\n\t\t}\n\t}\n};\n\nTokenizer.prototype._stateInNamedEntity = function(c){\n\tif(c === \";\"){\n\t\tthis._parseNamedEntityStrict();\n\t\tif(this._sectionStart + 1 < this._index && !this._xmlMode){\n\t\t\tthis._parseLegacyEntity();\n\t\t}\n\t\tthis._state = this._baseState;\n\t} else if((c < \"a\" || c > \"z\") && (c < \"A\" || c > \"Z\") && (c < \"0\" || c > \"9\")){\n\t\tif(this._xmlMode);\n\t\telse if(this._sectionStart + 1 === this._index);\n\t\telse if(this._baseState !== TEXT){\n\t\t\tif(c !== \"=\"){\n\t\t\t\tthis._parseNamedEntityStrict();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._parseLegacyEntity();\n\t\t}\n\n\t\tthis._state = this._baseState;\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._decodeNumericEntity = function(offset, base){\n\tvar sectionStart = this._sectionStart + offset;\n\n\tif(sectionStart !== this._index){\n\t\t//parse entity\n\t\tvar entity = this._buffer.substring(sectionStart, this._index);\n\t\tvar parsed = parseInt(entity, base);\n\n\t\tthis._emitPartial(decodeCodePoint(parsed));\n\t\tthis._sectionStart = this._index;\n\t} else {\n\t\tthis._sectionStart--;\n\t}\n\n\tthis._state = this._baseState;\n};\n\nTokenizer.prototype._stateInNumericEntity = function(c){\n\tif(c === \";\"){\n\t\tthis._decodeNumericEntity(2, 10);\n\t\tthis._sectionStart++;\n\t} else if(c < \"0\" || c > \"9\"){\n\t\tif(!this._xmlMode){\n\t\t\tthis._decodeNumericEntity(2, 10);\n\t\t} else {\n\t\t\tthis._state = this._baseState;\n\t\t}\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._stateInHexEntity = function(c){\n\tif(c === \";\"){\n\t\tthis._decodeNumericEntity(3, 16);\n\t\tthis._sectionStart++;\n\t} else if((c < \"a\" || c > \"f\") && (c < \"A\" || c > \"F\") && (c < \"0\" || c > \"9\")){\n\t\tif(!this._xmlMode){\n\t\t\tthis._decodeNumericEntity(3, 16);\n\t\t} else {\n\t\t\tthis._state = this._baseState;\n\t\t}\n\t\tthis._index--;\n\t}\n};\n\nTokenizer.prototype._cleanup = function (){\n\tif(this._sectionStart < 0){\n\t\tthis._buffer = \"\";\n\t\tthis._index = 0;\n\t\tthis._bufferOffset += this._index;\n\t} else if(this._running){\n\t\tif(this._state === TEXT){\n\t\t\tif(this._sectionStart !== this._index){\n\t\t\t\tthis._cbs.ontext(this._buffer.substr(this._sectionStart));\n\t\t\t}\n\t\t\tthis._buffer = \"\";\n\t\t\tthis._index = 0;\n\t\t\tthis._bufferOffset += this._index;\n\t\t} else if(this._sectionStart === this._index){\n\t\t\t//the section just started\n\t\t\tthis._buffer = \"\";\n\t\t\tthis._index = 0;\n\t\t\tthis._bufferOffset += this._index;\n\t\t} else {\n\t\t\t//remove everything unnecessary\n\t\t\tthis._buffer = this._buffer.substr(this._sectionStart);\n\t\t\tthis._index -= this._sectionStart;\n\t\t\tthis._bufferOffset += this._sectionStart;\n\t\t}\n\n\t\tthis._sectionStart = 0;\n\t}\n};\n\n//TODO make events conditional\nTokenizer.prototype.write = function(chunk){\n\tif(this._ended) this._cbs.onerror(Error(\".write() after done!\"));\n\n\tthis._buffer += chunk;\n\tthis._parse();\n};\n\nTokenizer.prototype._parse = function(){\n\twhile(this._index < this._buffer.length && this._running){\n\t\tvar c = this._buffer.charAt(this._index);\n\t\tif(this._state === TEXT) {\n\t\t\tthis._stateText(c);\n\t\t} else if(this._state === BEFORE_TAG_NAME){\n\t\t\tthis._stateBeforeTagName(c);\n\t\t} else if(this._state === IN_TAG_NAME) {\n\t\t\tthis._stateInTagName(c);\n\t\t} else if(this._state === BEFORE_CLOSING_TAG_NAME){\n\t\t\tthis._stateBeforeCloseingTagName(c);\n\t\t} else if(this._state === IN_CLOSING_TAG_NAME){\n\t\t\tthis._stateInCloseingTagName(c);\n\t\t} else if(this._state === AFTER_CLOSING_TAG_NAME){\n\t\t\tthis._stateAfterCloseingTagName(c);\n\t\t} else if(this._state === IN_SELF_CLOSING_TAG){\n\t\t\tthis._stateInSelfClosingTag(c);\n\t\t}\n\n\t\t/*\n\t\t*\tattributes\n\t\t*/\n\t\telse if(this._state === BEFORE_ATTRIBUTE_NAME){\n\t\t\tthis._stateBeforeAttributeName(c);\n\t\t} else if(this._state === IN_ATTRIBUTE_NAME){\n\t\t\tthis._stateInAttributeName(c);\n\t\t} else if(this._state === AFTER_ATTRIBUTE_NAME){\n\t\t\tthis._stateAfterAttributeName(c);\n\t\t} else if(this._state === BEFORE_ATTRIBUTE_VALUE){\n\t\t\tthis._stateBeforeAttributeValue(c);\n\t\t} else if(this._state === IN_ATTRIBUTE_VALUE_DQ){\n\t\t\tthis._stateInAttributeValueDoubleQuotes(c);\n\t\t} else if(this._state === IN_ATTRIBUTE_VALUE_SQ){\n\t\t\tthis._stateInAttributeValueSingleQuotes(c);\n\t\t} else if(this._state === IN_ATTRIBUTE_VALUE_NQ){\n\t\t\tthis._stateInAttributeValueNoQuotes(c);\n\t\t}\n\n\t\t/*\n\t\t*\tdeclarations\n\t\t*/\n\t\telse if(this._state === BEFORE_DECLARATION){\n\t\t\tthis._stateBeforeDeclaration(c);\n\t\t} else if(this._state === IN_DECLARATION){\n\t\t\tthis._stateInDeclaration(c);\n\t\t}\n\n\t\t/*\n\t\t*\tprocessing instructions\n\t\t*/\n\t\telse if(this._state === IN_PROCESSING_INSTRUCTION){\n\t\t\tthis._stateInProcessingInstruction(c);\n\t\t}\n\n\t\t/*\n\t\t*\tcomments\n\t\t*/\n\t\telse if(this._state === BEFORE_COMMENT){\n\t\t\tthis._stateBeforeComment(c);\n\t\t} else if(this._state === IN_COMMENT){\n\t\t\tthis._stateInComment(c);\n\t\t} else if(this._state === AFTER_COMMENT_1){\n\t\t\tthis._stateAfterComment1(c);\n\t\t} else if(this._state === AFTER_COMMENT_2){\n\t\t\tthis._stateAfterComment2(c);\n\t\t}\n\n\t\t/*\n\t\t*\tcdata\n\t\t*/\n\t\telse if(this._state === BEFORE_CDATA_1){\n\t\t\tthis._stateBeforeCdata1(c);\n\t\t} else if(this._state === BEFORE_CDATA_2){\n\t\t\tthis._stateBeforeCdata2(c);\n\t\t} else if(this._state === BEFORE_CDATA_3){\n\t\t\tthis._stateBeforeCdata3(c);\n\t\t} else if(this._state === BEFORE_CDATA_4){\n\t\t\tthis._stateBeforeCdata4(c);\n\t\t} else if(this._state === BEFORE_CDATA_5){\n\t\t\tthis._stateBeforeCdata5(c);\n\t\t} else if(this._state === BEFORE_CDATA_6){\n\t\t\tthis._stateBeforeCdata6(c);\n\t\t} else if(this._state === IN_CDATA){\n\t\t\tthis._stateInCdata(c);\n\t\t} else if(this._state === AFTER_CDATA_1){\n\t\t\tthis._stateAfterCdata1(c);\n\t\t} else if(this._state === AFTER_CDATA_2){\n\t\t\tthis._stateAfterCdata2(c);\n\t\t}\n\n\t\t/*\n\t\t* special tags\n\t\t*/\n\t\telse if(this._state === BEFORE_SPECIAL){\n\t\t\tthis._stateBeforeSpecial(c);\n\t\t} else if(this._state === BEFORE_SPECIAL_END){\n\t\t\tthis._stateBeforeSpecialEnd(c);\n\t\t}\n\n\t\t/*\n\t\t* script\n\t\t*/\n\t\telse if(this._state === BEFORE_SCRIPT_1){\n\t\t\tthis._stateBeforeScript1(c);\n\t\t} else if(this._state === BEFORE_SCRIPT_2){\n\t\t\tthis._stateBeforeScript2(c);\n\t\t} else if(this._state === BEFORE_SCRIPT_3){\n\t\t\tthis._stateBeforeScript3(c);\n\t\t} else if(this._state === BEFORE_SCRIPT_4){\n\t\t\tthis._stateBeforeScript4(c);\n\t\t} else if(this._state === BEFORE_SCRIPT_5){\n\t\t\tthis._stateBeforeScript5(c);\n\t\t}\n\n\t\telse if(this._state === AFTER_SCRIPT_1){\n\t\t\tthis._stateAfterScript1(c);\n\t\t} else if(this._state === AFTER_SCRIPT_2){\n\t\t\tthis._stateAfterScript2(c);\n\t\t} else if(this._state === AFTER_SCRIPT_3){\n\t\t\tthis._stateAfterScript3(c);\n\t\t} else if(this._state === AFTER_SCRIPT_4){\n\t\t\tthis._stateAfterScript4(c);\n\t\t} else if(this._state === AFTER_SCRIPT_5){\n\t\t\tthis._stateAfterScript5(c);\n\t\t}\n\n\t\t/*\n\t\t* style\n\t\t*/\n\t\telse if(this._state === BEFORE_STYLE_1){\n\t\t\tthis._stateBeforeStyle1(c);\n\t\t} else if(this._state === BEFORE_STYLE_2){\n\t\t\tthis._stateBeforeStyle2(c);\n\t\t} else if(this._state === BEFORE_STYLE_3){\n\t\t\tthis._stateBeforeStyle3(c);\n\t\t} else if(this._state === BEFORE_STYLE_4){\n\t\t\tthis._stateBeforeStyle4(c);\n\t\t}\n\n\t\telse if(this._state === AFTER_STYLE_1){\n\t\t\tthis._stateAfterStyle1(c);\n\t\t} else if(this._state === AFTER_STYLE_2){\n\t\t\tthis._stateAfterStyle2(c);\n\t\t} else if(this._state === AFTER_STYLE_3){\n\t\t\tthis._stateAfterStyle3(c);\n\t\t} else if(this._state === AFTER_STYLE_4){\n\t\t\tthis._stateAfterStyle4(c);\n\t\t}\n\n\t\t/*\n\t\t* entities\n\t\t*/\n\t\telse if(this._state === BEFORE_ENTITY){\n\t\t\tthis._stateBeforeEntity(c);\n\t\t} else if(this._state === BEFORE_NUMERIC_ENTITY){\n\t\t\tthis._stateBeforeNumericEntity(c);\n\t\t} else if(this._state === IN_NAMED_ENTITY){\n\t\t\tthis._stateInNamedEntity(c);\n\t\t} else if(this._state === IN_NUMERIC_ENTITY){\n\t\t\tthis._stateInNumericEntity(c);\n\t\t} else if(this._state === IN_HEX_ENTITY){\n\t\t\tthis._stateInHexEntity(c);\n\t\t}\n\n\t\telse {\n\t\t\tthis._cbs.onerror(Error(\"unknown _state\"), this._state);\n\t\t}\n\n\t\tthis._index++;\n\t}\n\n\tthis._cleanup();\n};\n\nTokenizer.prototype.pause = function(){\n\tthis._running = false;\n};\nTokenizer.prototype.resume = function(){\n\tthis._running = true;\n\n\tif(this._index < this._buffer.length){\n\t\tthis._parse();\n\t}\n\tif(this._ended){\n\t\tthis._finish();\n\t}\n};\n\nTokenizer.prototype.end = function(chunk){\n\tif(this._ended) this._cbs.onerror(Error(\".end() after done!\"));\n\tif(chunk) this.write(chunk);\n\n\tthis._ended = true;\n\n\tif(this._running) this._finish();\n};\n\nTokenizer.prototype._finish = function(){\n\t//if there is remaining data, emit it in a reasonable way\n\tif(this._sectionStart < this._index){\n\t\tthis._handleTrailingData();\n\t}\n\n\tthis._cbs.onend();\n};\n\nTokenizer.prototype._handleTrailingData = function(){\n\tvar data = this._buffer.substr(this._sectionStart);\n\n\tif(this._state === IN_CDATA || this._state === AFTER_CDATA_1 || this._state === AFTER_CDATA_2){\n\t\tthis._cbs.oncdata(data);\n\t} else if(this._state === IN_COMMENT || this._state === AFTER_COMMENT_1 || this._state === AFTER_COMMENT_2){\n\t\tthis._cbs.oncomment(data);\n\t} else if(this._state === IN_NAMED_ENTITY && !this._xmlMode){\n\t\tthis._parseLegacyEntity();\n\t\tif(this._sectionStart < this._index){\n\t\t\tthis._state = this._baseState;\n\t\t\tthis._handleTrailingData();\n\t\t}\n\t} else if(this._state === IN_NUMERIC_ENTITY && !this._xmlMode){\n\t\tthis._decodeNumericEntity(2, 10);\n\t\tif(this._sectionStart < this._index){\n\t\t\tthis._state = this._baseState;\n\t\t\tthis._handleTrailingData();\n\t\t}\n\t} else if(this._state === IN_HEX_ENTITY && !this._xmlMode){\n\t\tthis._decodeNumericEntity(3, 16);\n\t\tif(this._sectionStart < this._index){\n\t\t\tthis._state = this._baseState;\n\t\t\tthis._handleTrailingData();\n\t\t}\n\t} else if(\n\t\tthis._state !== IN_TAG_NAME &&\n\t\tthis._state !== BEFORE_ATTRIBUTE_NAME &&\n\t\tthis._state !== BEFORE_ATTRIBUTE_VALUE &&\n\t\tthis._state !== AFTER_ATTRIBUTE_NAME &&\n\t\tthis._state !== IN_ATTRIBUTE_NAME &&\n\t\tthis._state !== IN_ATTRIBUTE_VALUE_SQ &&\n\t\tthis._state !== IN_ATTRIBUTE_VALUE_DQ &&\n\t\tthis._state !== IN_ATTRIBUTE_VALUE_NQ &&\n\t\tthis._state !== IN_CLOSING_TAG_NAME\n\t){\n\t\tthis._cbs.ontext(data);\n\t}\n\t//else, ignore remaining data\n\t//TODO add a way to remove current tag\n};\n\nTokenizer.prototype.reset = function(){\n\tTokenizer.call(this, {xmlMode: this._xmlMode, decodeEntities: this._decodeEntities}, this._cbs);\n};\n\nTokenizer.prototype.getAbsoluteIndex = function(){\n\treturn this._bufferOffset + this._index;\n};\n\nTokenizer.prototype._getSection = function(){\n\treturn this._buffer.substring(this._sectionStart, this._index);\n};\n\nTokenizer.prototype._emitToken = function(name){\n\tthis._cbs[name](this._getSection());\n\tthis._sectionStart = -1;\n};\n\nTokenizer.prototype._emitPartial = function(value){\n\tif(this._baseState !== TEXT){\n\t\tthis._cbs.onattribdata(value); //TODO implement the new event\n\t} else {\n\t\tthis._cbs.ontext(value);\n\t}\n};\n"]},"metadata":{},"sourceType":"script"}